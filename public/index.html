<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search AI - Fast. Clean. No spam.</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîç</text></svg>">
<style>
body {
    font-family: arial, sans-serif;
    background: #fff;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 652px;
    margin: 20px auto;
    padding: 0 16px;
}

.header {
    text-align: center;
    margin-bottom: 30px;
}

.logo {
    font-size: 48px;
    font-weight: 400;
    color: #202124;
    margin-bottom: 4px;
    letter-spacing: -1px;
}

.tagline {
    font-size: 13px;
    color: #70757a;
    margin-bottom: 28px;
}

.search-box {
    width: 100%;
    max-width: 584px;
    padding: 13px 80px 13px 16px;
    font-size: 16px;
    border: 1px solid #dfe1e5;
    border-radius: 24px;
    outline: none;
    box-sizing: border-box;
    position: relative;
    background: transparent;
    z-index: 2;
    margin: 0 auto;
    display: block;
}

.search-box:hover {
    border-color: #ccc;
    box-shadow: 0 1px 6px rgba(32,33,36,.28);
}

.search-box:focus {
    border-color: transparent;
    box-shadow: 0 1px 6px rgba(32,33,36,.28);
}

.search-clear-btn {
    position: absolute;
    right: 50px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    font-size: 18px;
    color: #70757a;
    cursor: pointer;
    padding: 8px;
    z-index: 3;
    transition: all 0.2s;
}

.search-clear-btn:hover {
    color: #202124;
}

.search-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    padding: 8px 12px;
    z-index: 3;
    transition: all 0.2s;
}

.search-btn:hover {
    transform: translateY(-50%) scale(1.1);
}

.search-wrapper {
    position: relative;
    max-width: 584px;
    margin: 0 auto 20px;
}

.search-suggestion {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 13px 16px;
    font-size: 16px;
    border: 1px solid transparent;
    border-radius: 24px;
    color: #80868b;
    pointer-events: none;
    box-sizing: border-box;
    z-index: 1;
}

/* Widget Triggers */
.widget-triggers {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px auto;
}

.widget-icon {
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: all 0.2s;
    position: relative;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
}

.widget-icon:hover {
    background: #e8eaed;
    transform: scale(1.1);
}

.icon-emoji {
    font-size: 28px;
}

.widget-icon.hidden {
    display: none;
}

/* Tooltip */
.widget-icon::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: #202124;
    color: #fff;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}

.widget-icon:hover::after {
    opacity: 1;
}

/* Widget Close Button (Top Right X) */
.widget-close-x {
    position: absolute;
    top: 16px;
    right: 16px;
    background: none;
    border: none;
    font-size: 20px;
    color: #5f6368;
    cursor: pointer;
    padding: 4px 8px;
    z-index: 10;
    transition: all 0.2s;
}

.widget-close-x:hover {
    color: #202124;
    transform: scale(1.1);
}

/* Calculator Widget */
.calculator-widget {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 320px;
    margin: 20px auto;
    position: relative;
}

.calculator-display {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 8px;
    padding: 16px 40px 16px 16px;
    font-size: 24px;
    font-weight: 300;
    text-align: right;
    margin-bottom: 16px;
    color: #202124;
    min-height: 60px;
    word-wrap: break-word;
}

.calculator-input {
    width: 100%;
    padding: 12px 40px 12px 12px;
    font-size: 18px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    outline: none;
    margin-bottom: 12px;
    box-sizing: border-box;
}

.calculator-input:focus {
    border-color: #1a73e8;
}

.calculator-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-bottom: 12px;
}

.calc-btn {
    padding: 16px;
    font-size: 18px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    background: #f8f9fa;
    cursor: pointer;
    transition: all 0.2s;
    font-family: arial, sans-serif;
}

.calc-btn:hover {
    background: #e8eaed;
}

.calc-btn:active {
    transform: scale(0.95);
}

.calc-btn.operator {
    background: #e8f0fe;
    color: #1a73e8;
    font-weight: 600;
}

.calc-btn.equals {
    background: #1a73e8;
    color: white;
    font-weight: 600;
}

.calc-btn.equals:hover {
    background: #1967d2;
}

.calc-btn.clear {
    background: #fce8e6;
    color: #d93025;
}

.calc-btn.clear:hover {
    background: #f5c8c6;
}

.calculator-close {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    width: 100%;
    margin-top: 12px;
    font-family: arial, sans-serif;
}

.calculator-close:hover {
    background: #f1f3f4;
}

/* Sports Widget */
.sports-widget {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 20px auto;
    position: relative;
}

.sports-header {
    font-size: 18px;
    font-weight: 600;
    color: #202124;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.sports-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    overflow-x: auto;
}

.sport-tab {
    padding: 8px 16px;
    border-radius: 20px;
    background: #f8f9fa;
    border: 1px solid #dadce0;
    cursor: pointer;
    font-size: 14px;
    color: #5f6368;
    white-space: nowrap;
    transition: all 0.2s;
}

.sport-tab:hover {
    background: #e8eaed;
}

.sport-tab.active {
    background: #1a73e8;
    color: white;
    border-color: #1a73e8;
}

.sports-games {
    max-height: 400px;
    overflow-y: auto;
}

.game-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.game-team {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
}

.team-logo {
    width: 32px;
    height: 32px;
    border-radius: 4px;
}

.team-name {
    font-size: 15px;
    font-weight: 500;
    color: #202124;
}

.game-score {
    font-size: 20px;
    font-weight: 600;
    color: #202124;
    min-width: 40px;
    text-align: center;
}

.game-status {
    font-size: 12px;
    color: #5f6368;
    text-align: center;
    margin-top: 4px;
}

.game-live {
    color: #d93025;
    font-weight: 600;
}

.game-live::before {
    content: "‚óè ";
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.sports-loading {
    text-align: center;
    padding: 40px;
    color: #5f6368;
}

.sports-close {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    width: 100%;
    margin-top: 12px;
    font-family: arial, sans-serif;
}

.sports-close:hover {
    background: #f1f3f4;
}

/* World Clock Widget */
.clock-widget {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 20px auto;
    position: relative;
}

.clock-header {
    font-size: 18px;
    font-weight: 600;
    color: #202124;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.clock-search-box {
    position: relative;
    margin-bottom: 16px;
}

.clock-search-input {
    width: 100%;
    padding: 12px 40px 12px 12px;
    font-size: 14px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    outline: none;
    box-sizing: border-box;
}

.clock-search-input:focus {
    border-color: #1a73e8;
}

.clock-search-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 16px;
    color: #5f6368;
}

.clock-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #dadce0;
    border-radius: 8px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 10;
    margin-top: 4px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.clock-suggestion-item {
    padding: 10px 12px;
    cursor: pointer;
    font-size: 14px;
    color: #202124;
    border-bottom: 1px solid #f1f3f4;
}

.clock-suggestion-item:last-child {
    border-bottom: none;
}

.clock-suggestion-item:hover {
    background: #f8f9fa;
}

.clock-suggestion-city {
    font-weight: 500;
}

.clock-suggestion-tz {
    font-size: 12px;
    color: #5f6368;
    margin-left: 8px;
}

.clock-list {
    max-height: 400px;
    overflow-y: auto;
}

.clock-empty {
    text-align: center;
    padding: 40px 20px;
    color: #5f6368;
    font-size: 14px;
}

.clock-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.clock-city-name {
    font-size: 16px;
    font-weight: 600;
    color: #202124;
    margin-bottom: 4px;
}

.clock-timezone {
    font-size: 12px;
    color: #5f6368;
}

.clock-time {
    text-align: right;
}

.clock-time-display {
    font-size: 24px;
    font-weight: 300;
    color: #202124;
    margin-bottom: 4px;
}

.clock-date-display {
    font-size: 12px;
    color: #5f6368;
}

.clock-remove {
    background: #fce8e6;
    border: none;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    cursor: pointer;
    font-size: 14px;
    color: #d93025;
    margin-left: 12px;
    transition: all 0.2s;
}

.clock-remove:hover {
    background: #f5c8c6;
    transform: scale(1.1);
}

.clock-close {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    width: 100%;
    margin-top: 12px;
    font-family: arial, sans-serif;
}

.clock-close:hover {
    background: #f1f3f4;
}

/* Wiki Widget */
.wiki-widget {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 600px;
    margin: 20px auto;
    position: relative;
}

.wiki-header {
    font-size: 18px;
    font-weight: 600;
    color: #202124;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.wiki-subheader {
    font-size: 12px;
    color: #5f6368;
    margin-bottom: 16px;
}

.wiki-search-box {
    position: relative;
    margin-bottom: 16px;
}

.wiki-search-input {
    width: 100%;
    padding: 12px 40px 12px 12px;
    font-size: 14px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    outline: none;
    box-sizing: border-box;
}

.wiki-search-input:focus {
    border-color: #1a73e8;
}

.wiki-search-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: #1a73e8;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    color: white;
    font-size: 12px;
    cursor: pointer;
    font-family: arial, sans-serif;
}

.wiki-search-btn:hover {
    background: #1967d2;
}

.wiki-results {
    max-height: 500px;
    overflow-y: auto;
}

.wiki-loading {
    text-align: center;
    padding: 40px;
    color: #5f6368;
}

.wiki-empty {
    text-align: center;
    padding: 40px 20px;
    color: #5f6368;
    font-size: 14px;
}

.wiki-result-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 12px;
}

.wiki-result-title {
    font-size: 18px;
    font-weight: 600;
    color: #1a0dab;
    margin-bottom: 8px;
    cursor: pointer;
    text-decoration: none;
    display: block;
}

.wiki-result-title:hover {
    text-decoration: underline;
}

.wiki-result-summary {
    font-size: 14px;
    line-height: 20px;
    color: #202124;
    margin-bottom: 8px;
}

.wiki-result-link {
    font-size: 12px;
    color: #1a73e8;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.wiki-result-link:hover {
    text-decoration: underline;
}

.wiki-footer {
    font-size: 11px;
    color: #5f6368;
    text-align: center;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid #dadce0;
}

.wiki-close {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    width: 100%;
    margin-top: 12px;
    font-family: arial, sans-serif;
}

.wiki-close:hover {
    background: #f1f3f4;
}

/* Shortcuts */
.shortcuts-section {
    margin: 30px 0;
}

.shortcuts-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
}

.shortcut {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px;
    text-decoration: none;
    color: #202124;
    cursor: pointer;
}

.shortcut:hover {
    opacity: 0.8;
}

.shortcut-icon {
    width: 56px;
    height: 56px;
    background: #f1f3f4;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
}

.shortcut img {
    width: 32px;
    height: 32px;
}

.shortcut span {
    font-size: 13px;
    text-align: center;
}

.shortcut[data-priority="2"] {
    display: none;
}

/* Weather Widget */
.weather-widget {
    background: white;
    border-radius: 12px;
    padding: 16px 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 584px;
    margin: 20px auto;
    transition: all 0.2s;
    position: relative;
}

.weather-widget:hover {
    box-shadow: 0 2px 12px rgba(0,0,0,0.15);
}

.weather-widget-small {
    display: flex;
    align-items: center;
    gap: 16px;
}

.weather-location {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 16px;
    font-weight: 600;
    color: #202124;
    margin-bottom: 4px;
}

.weather-time {
    font-size: 12px;
    color: #70757a;
    margin-bottom: 8px;
}

.weather-main {
    display: flex;
    align-items: center;
    gap: 12px;
}

.weather-icon {
    width: 64px;
    height: 64px;
}

.weather-temp {
    font-size: 48px;
    font-weight: 300;
    color: #202124;
}

.weather-unit {
    font-size: 24px;
    color: #70757a;
}

.weather-condition {
    font-size: 18px;
    color: #202124;
    margin-left: auto;
}

.weather-rain-info {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: #1a73e8;
    margin-top: 8px;
}

.weather-expand-btn {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    margin-top: 12px;
    width: 100%;
    font-family: arial, sans-serif;
}

.weather-expand-btn:hover {
    background: #f1f3f4;
}

.weather-widget-full {
    display: none;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #dadce0;
}

.weather-widget-full.expanded {
    display: block;
}

.weather-forecast {
    display: flex;
    gap: 12px;
    padding: 12px 0;
}

.forecast-day {
    text-align: center;
    min-width: 80px;
}

.forecast-day-name {
    font-size: 12px;
    color: #70757a;
    margin-bottom: 8px;
}

.forecast-icon {
    width: 40px;
    height: 40px;
    margin: 0 auto;
}

.forecast-temp {
    font-size: 14px;
    color: #202124;
    margin-top: 8px;
}

.forecast-temp-high {
    font-weight: 600;
}

.forecast-temp-low {
    color: #70757a;
}

.weather-change-location {
    margin-top: 16px;
}

.weather-location-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #dadce0;
    border-radius: 20px;
    font-size: 14px;
    outline: none;
}

.weather-location-input:focus {
    border-color: #1a73e8;
}

/* Hourly forecast - single horizontal line on all devices */
.hourly-forecast-container {
    display: flex;
    overflow-x: auto;
    gap: 16px;
    padding: 12px 0;
    -webkit-overflow-scrolling: touch;
}

.hourly-forecast-container::-webkit-scrollbar {
    height: 4px;
}

.hourly-forecast-container::-webkit-scrollbar-track {
    background: #f1f3f4;
}

.hourly-forecast-container::-webkit-scrollbar-thumb {
    background: #dadce0;
    border-radius: 2px;
}

.hourly-item {
    flex-shrink: 0;
    text-align: center;
    min-width: 70px;
}

/* Results */
.results-container {
    margin-top: 20px;
}

.result {
    margin-bottom: 28px;
}

.result-source {
    display: flex;
    align-items: center;
    margin-bottom: 2px;
}

.result-favicon {
    width: 18px;
    height: 18px;
    margin-right: 8px;
    border-radius: 50%;
}

.result-source-name {
    font-size: 14px;
    line-height: 20px;
    color: #202124;
}

.result-url-display {
    font-size: 12px;
    line-height: 18px;
    color: #5f6368;
    margin-bottom: 4px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.result-title {
    margin: 0 0 4px 0;
    font-size: 20px;
    line-height: 26px;
}

.result-title a {
    color: #1a0dab;
    text-decoration: none;
}

.result-title a:visited {
    color: #681da8;
}

.result-title a:hover {
    text-decoration: underline;
}

.result-snippet {
    font-size: 14px;
    line-height: 22px;
    color: #4d5156;
    margin-bottom: 4px;
}

.read-more {
    font-size: 14px;
    color: #1a0dab;
    cursor: pointer;
    display: inline-block;
}

.read-more:hover {
    text-decoration: underline;
}

.loading {
    color: #70757a;
    padding: 20px 0;
}

.error {
    color: #d93025;
    padding: 20px 0;
}

/* Mobile Dark Mode */
@media (max-width: 768px) {
    body {
        background: #1a1a1a;
        color: #e8eaed;
    }
    
    .logo {
        color: #e8eaed;
    }
    
    .tagline {
        color: #9aa0a6;
    }
    
    .search-box {
        background: #2d2d2d;
        border: 1px solid #3c4043;
        color: #e8eaed;
    }
    
    .search-box::placeholder {
        color: #9aa0a6;
    }
    
    .search-clear-btn {
        color: #9aa0a6;
    }
    
    .search-clear-btn:hover {
        color: #e8eaed;
    }
    
    .search-btn {
        color: #9aa0a6;
    }
    
    .search-suggestion {
        color: #5f6368;
    }
    
    /* Smaller widget icons on mobile */
    .widget-icon {
        width: 36px !important;
        height: 36px !important;
        padding: 6px !important;
    }
    
    .icon-emoji {
        font-size: 20px !important;
    }
    
    .widget-triggers {
        gap: 12px !important;
    }
    
    /* Widget close button dark mode */
    .widget-close-x {
        color: #9aa0a6;
    }
    
    .widget-close-x:hover {
        color: #e8eaed;
    }
    
    .result {
        background: #2d2d2d;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 12px;
    }
    
    .result-source-name {
        color: #e8eaed;
    }
    
    .result-url-display {
        color: #9aa0a6;
    }
    
    .result-snippet {
        color: #bdc1c6;
    }
    
    .result-title a {
        color: #8ab4f8;
    }
    
    .result-title a:visited {
        color: #c58af9;
    }
    
    .result-snippet {
        color: #bdc1c6;
    }
    
    .read-more {
        color: #8ab4f8;
    }
    
    .loading {
        color: #9aa0a6;
    }
    
    .error {
        color: #f28b82;
    }
    
    /* Weather widget dark mode */
    .weather-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
        max-width: 100%;
        margin: 20px 0;
    }
    
    .weather-location,
    .weather-temp {
        color: #e8eaed;
    }
    
    .weather-time,
    .weather-unit,
    .forecast-day-name,
    .forecast-temp-low {
        color: #9aa0a6;
    }
    
    .weather-expand-btn {
        background: #3c4043 !important;
        border-color: #5f6368 !important;
        color: #e8eaed !important;
    }
    
    .weather-widget-full {
        border-top-color: #5f6368;
    }
    
    /* Mobile hourly forecast scrollbar */
    .hourly-forecast-container::-webkit-scrollbar-track {
        background: transparent;
    }
    
    .hourly-forecast-container::-webkit-scrollbar-thumb {
        background: #5f6368;
    }
    
    .weather-location-input {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .shortcut {
        color: #e8eaed;
    }
    
    .shortcut-icon {
        background: #3c4043;
    }
    
    /* Widget icons dark mode */
    .widget-icon {
        background: #3c4043;
    }
    
    .widget-icon:hover {
        background: #5f6368;
    }
    
    .widget-icon::after {
        background: #5f6368;
    }
    
    /* Calculator dark mode */
    .calculator-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
    }
    
    .calculator-display {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .calculator-input {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .calculator-input::placeholder {
        color: #9aa0a6;
    }
    
    .calc-btn {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .calc-btn:hover {
        background: #5f6368;
    }
    
    .calc-btn.operator {
        background: #1e3a5f;
        color: #8ab4f8;
    }
    
    .calc-btn.equals {
        background: #1a73e8;
    }
    
    .calc-btn.clear {
        background: #5f2120;
        color: #f28b82;
    }
    
    .calculator-close {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .calculator-close:hover {
        background: #5f6368;
    }
    
    /* Sports widget dark mode */
    .sports-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
    }
    
    .sports-header {
        color: #e8eaed;
    }
    
    .sport-tab {
        background: #3c4043;
        border-color: #5f6368;
        color: #9aa0a6;
    }
    
    .sport-tab:hover {
        background: #5f6368;
    }
    
    .sport-tab.active {
        background: #1a73e8;
        color: white;
    }
    
    .game-card {
        background: #3c4043;
    }
    
    .team-name,
    .game-score {
        color: #e8eaed;
    }
    
    .game-status {
        color: #9aa0a6;
    }
    
    .game-live {
        color: #f28b82;
    }
    
    .sports-loading {
        color: #9aa0a6;
    }
    
    .sports-close {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .sports-close:hover {
        background: #5f6368;
    }
    
    /* World clock dark mode */
    .clock-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
    }
    
    .clock-header {
        color: #e8eaed;
    }
    
    .clock-search-input {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .clock-search-input::placeholder {
        color: #9aa0a6;
    }
    
    .clock-search-icon {
        color: #9aa0a6;
    }
    
    .clock-suggestions {
        background: #3c4043;
        border-color: #5f6368;
    }
    
    .clock-suggestion-item {
        color: #e8eaed;
        border-bottom-color: #5f6368;
    }
    
    .clock-suggestion-item:hover {
        background: #5f6368;
    }
    
    .clock-suggestion-tz {
        color: #9aa0a6;
    }
    
    .clock-empty {
        color: #9aa0a6;
    }
    
    .clock-card {
        background: #3c4043;
    }
    
    .clock-city-name,
    .clock-time-display {
        color: #e8eaed;
    }
    
    .clock-timezone,
    .clock-date-display {
        color: #9aa0a6;
    }
    
    .clock-remove {
        background: #5f2120;
        color: #f28b82;
    }
    
    .clock-remove:hover {
        background: #7a2a29;
    }
    
    .clock-close {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .clock-close:hover {
        background: #5f6368;
    }
    
    /* Wiki widget dark mode */
    .wiki-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
    }
    
    .wiki-header {
        color: #e8eaed;
    }
    
    .wiki-subheader {
        color: #9aa0a6;
    }
    
    .wiki-search-input {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .wiki-search-input::placeholder {
        color: #9aa0a6;
    }
    
    .wiki-search-btn {
        background: #1a73e8;
    }
    
    .wiki-loading,
    .wiki-empty {
        color: #9aa0a6;
    }
    
    .wiki-result-card {
        background: #3c4043;
    }
    
    .wiki-result-title {
        color: #8ab4f8;
    }
    
    .wiki-result-summary {
        color: #bdc1c6;
    }
    
    .wiki-result-link {
        color: #8ab4f8;
    }
    
    .wiki-footer {
        color: #9aa0a6;
        border-top-color: #5f6368;
    }
    
    .wiki-close {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .wiki-close:hover {
        background: #5f6368;
    }
    
    /* Mobile-specific weather detail colors */
    .weather-widget div[style*="color: #70757a"] {
        color: #9aa0a6 !important;
    }
    
    .weather-widget div[style*="color: #202124"] {
        color: #e8eaed !important;
    }
}

/* Tablet */
@media (min-width: 768px) {
    .shortcuts-grid {
        gap: 8px;
    }
    
    .shortcut-icon {
        width: 64px;
        height: 64px;
    }
    
    .shortcut img {
        width: 32px;
        height: 32px;
    }
}

/* Desktop */
@media (min-width: 1200px) {
    .shortcuts-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    
    .shortcut[data-priority="2"] {
        display: none;
    }
}
/* AI Answer Styles - Google-style */
.simple-answer {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.brand-info {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
}

.factual-answer {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 20px;
}

.ai-summary {
    margin-bottom: 24px;
    padding: 0 0 24px 0;
    border-bottom: 1px solid #dadce0;
}

.answer-header, .brand-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 12px;
}

.ai-summary-header {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 400;
    margin-bottom: 12px;
    color: #1a73e8;
    font-family: 'Google Sans', 'Roboto', arial, sans-serif;
}

.answer-text, .brand-description {
    font-size: 15px;
    line-height: 1.7;
}

.ai-summary-content {
    display: flex;
    gap: 24px;
    align-items: flex-start;
}

.ai-summary-text-with-image {
    flex: 1;
    font-size: 14px;
    line-height: 1.58;
    color: #202124;
    font-family: arial, sans-serif;
}

.ai-summary-text-with-image p {
    margin: 0 0 16px 0;
    font-size: 14px;
    line-height: 1.58;
    color: #202124;
}

.ai-summary-text-with-image p:last-child {
    margin-bottom: 0;
}

.ai-summary-image {
    flex-shrink: 0;
    width: 200px;
}

.ai-summary-image img {
    width: 100%;
    height: auto;
    border-radius: 8px;
    display: block;
}

.image-caption {
    font-size: 12px;
    color: #70757a;
    margin-top: 8px;
    line-height: 1.4;
}

.ai-summary-text {
    font-size: 14px;
    line-height: 1.58;
    color: #202124;
    font-family: arial, sans-serif;
    white-space: normal;
    word-wrap: break-word;
}

.ai-summary-text p {
    margin: 0 0 16px 0;
    font-size: 14px;
    line-height: 1.58;
    color: #202124;
}

.ai-summary-text p:last-child {
    margin-bottom: 0;
}

.simple-answer .answer-text {
    font-size: 24px;
    font-weight: 600;
}

.answer-sources {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid rgba(255,255,255,0.2);
}

.sources-header {
    font-size: 14px;
    margin-bottom: 12px;
    opacity: 0.9;
}

.source-link {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 0;
    color: white;
    text-decoration: none;
    font-size: 14px;
}

.source-link:hover {
    text-decoration: underline;
}

.source-favicon {
    width: 16px;
    height: 16px;
    border-radius: 50%;
}

@media (max-width: 768px) {
    .simple-answer, .brand-info, .factual-answer {
        background: linear-gradient(135deg, #5568d3 0%, #6d3f8f 100%);
    }
    
    .ai-summary {
        padding: 0 0 20px 0;
        margin-bottom: 20px;
        border-bottom: 1px solid #3c4043;
    }
    
    .ai-summary-header {
        color: #8ab4f8;
        font-size: 14px;
    }
    
    .ai-summary-content {
        flex-direction: column;
        gap: 16px;
    }
    
    .ai-summary-image {
        width: 100%;
        order: -1;
    }
    
    .ai-summary-text {
        color: #e8eaed;
        font-size: 14px;
        line-height: 1.58;
    }
    
    .ai-summary-text p {
        color: #e8eaed;
        font-size: 14px;
        line-height: 1.58;
        margin: 0 0 16px 0;
    }
    
    .ai-summary-text-with-image {
        color: #e8eaed;
        font-size: 14px;
    }
    
    .ai-summary-text-with-image p {
        color: #e8eaed;
        font-size: 14px;
    }
    
    .image-caption {
        color: #9aa0a6;
    }
}
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo" onclick="goHome()" style="cursor: pointer;">Search AI</div>
        <div class="tagline">Fast. Clean. No spam.</div>
    </div>
    
    <div class="search-wrapper">
        <input id="searchSuggestion" class="search-suggestion" type="text" disabled />
        <input id="searchInput" class="search-box" type="text" placeholder="Search anything..." autocomplete="off" autofocus />
        <button id="searchClearBtn" class="search-clear-btn" onclick="clearMainSearch()">‚úï</button>
        <button id="searchBtn" class="search-btn" onclick="performMainSearch()">üîç</button>
    </div>
    
    <!-- Widget Triggers -->
    <div class="widget-triggers">
        <div class="widget-icon" id="weatherTrigger" data-tooltip="Weather">
            <span class="icon-emoji">‚õÖ</span>
        </div>
        <div class="widget-icon" id="calculatorTrigger" data-tooltip="Calculator">
            <span class="icon-emoji">üî¢</span>
        </div>
        <div class="widget-icon" id="sportsTrigger" data-tooltip="Sports Scores">
            <span class="icon-emoji">üèÄ</span>
        </div>
        <div class="widget-icon" id="clockTrigger" data-tooltip="World Clock">
            <span class="icon-emoji">üïê</span>
        </div>
        <div class="widget-icon" id="wikiTrigger" data-tooltip="Wiki Search">
            <span class="icon-emoji">üìö</span>
        </div>
    </div>
    
    <!-- Weather Widget -->
    <div id="weatherWidget" style="display: none;"></div>
    
    <!-- Calculator Widget -->
    <div id="calculatorWidget" style="display: none;"></div>
    
    <!-- Sports Widget -->
    <div id="sportsWidget" style="display: none;"></div>
    
    <!-- World Clock Widget -->
    <div id="clockWidget" style="display: none;"></div>
    
    <!-- Wiki Widget -->
    <div id="wikiWidget" style="display: none;"></div>
    
    <div class="shortcuts-section" id="shortcutsSection">
        <div class="shortcuts-grid" id="shortcutsGrid"></div>
    </div>
    
    <div id="results" class="results-container"></div>
</div>

<script>
const input = document.getElementById("searchInput");
const suggestionInput = document.getElementById("searchSuggestion");
const resultsDiv = document.getElementById("results");
const shortcutsSection = document.getElementById("shortcutsSection");
const shortcutsGrid = document.getElementById("shortcutsGrid");
const weatherWidget = document.getElementById("weatherWidget");
const weatherTrigger = document.getElementById("weatherTrigger");
const calculatorWidget = document.getElementById("calculatorWidget");
const calculatorTrigger = document.getElementById("calculatorTrigger");
const sportsWidget = document.getElementById("sportsWidget");
const sportsTrigger = document.getElementById("sportsTrigger");
const clockWidget = document.getElementById("clockWidget");
const clockTrigger = document.getElementById("clockTrigger");
const wikiWidget = document.getElementById("wikiWidget");
const wikiTrigger = document.getElementById("wikiTrigger");
const searchClearBtn = document.getElementById("searchClearBtn");

let shortcuts = [];
let navigationRouter = {};
let currentSuggestion = '';

// Weather API configuration
const WEATHER_API_KEY = '398b15f1e90c45738c260159260101';
let savedLocation = localStorage.getItem('weatherLocation') || 'auto:ip';
let weatherExpanded = false;
let selectedDay = 0;
let weatherLoaded = false;

// Calculator state
let calculatorLoaded = false;
let calcDisplay = '';

// Sports state
let sportsLoaded = false;
let currentSport = 'nfl';

// World Clock state
let clockLoaded = false;
let userClocks = [];
let clockUpdateInterval = null;
let citiesData = null;

// Wiki state
let wikiLoaded = false;

// Widget open states
let widgetStates = {
    weather: false,
    calculator: false,
    sports: false,
    clock: false,
    wiki: false
};

fetch('/shortcuts.json')
    .then(res => res.json())
    .then(data => {
        shortcuts = data;
        renderShortcuts();
    });

fetch('/navigation-router.json')
    .then(res => res.json())
    .then(data => {
        navigationRouter = data;
    });

// Utility Functions
function goHome() {
    closeAllWidgets();
    input.value = '';
    suggestionInput.value = '';
    resultsDiv.innerHTML = '';
    shortcutsSection.style.display = 'block';
}

function closeAllWidgets() {
    weatherWidget.style.display = 'none';
    calculatorWidget.style.display = 'none';
    sportsWidget.style.display = 'none';
    clockWidget.style.display = 'none';
    wikiWidget.style.display = 'none';
    stopClockUpdates();
    
    widgetStates.weather = false;
    widgetStates.calculator = false;
    widgetStates.sports = false;
    widgetStates.clock = false;
    widgetStates.wiki = false;
}

function closeWidget(widgetName) {
    switch(widgetName) {
        case 'weather':
            weatherWidget.style.display = 'none';
            widgetStates.weather = false;
            break;
        case 'calculator':
            calculatorWidget.style.display = 'none';
            widgetStates.calculator = false;
            break;
        case 'sports':
            sportsWidget.style.display = 'none';
            widgetStates.sports = false;
            break;
        case 'clock':
            clockWidget.style.display = 'none';
            stopClockUpdates();
            widgetStates.clock = false;
            break;
        case 'wiki':
            wikiWidget.style.display = 'none';
            widgetStates.wiki = false;
            break;
    }
    shortcutsSection.style.display = 'block';
}

function clearMainSearch() {
    input.value = '';
    suggestionInput.value = '';
    input.focus();
}

function performMainSearch() {
    const query = input.value.trim();
    if (query) {
        closeAllWidgets();
        handleSearch();
    }
}

// Weather icon click handler
weatherTrigger.addEventListener('click', async function() {
    if (widgetStates.weather) {
        // Already open, close it
        weatherWidget.style.display = 'none';
        widgetStates.weather = false;
    } else {
        // Close all others and open weather
        closeAllWidgets();
        
        if (!weatherLoaded) {
            const weatherData = await fetchWeather();
            if (weatherData) {
                window.currentWeatherData = weatherData;
                showWeatherWidget(weatherData);
                weatherLoaded = true;
            }
        } else {
            weatherWidget.style.display = 'block';
        }
        widgetStates.weather = true;
    }
});

// Calculator icon click handler
calculatorTrigger.addEventListener('click', function() {
    if (widgetStates.calculator) {
        // Already open, close it
        calculatorWidget.style.display = 'none';
        widgetStates.calculator = false;
    } else {
        // Close all others and open calculator
        closeAllWidgets();
        
        if (!calculatorLoaded) {
            showCalculator();
            calculatorLoaded = true;
        } else {
            calculatorWidget.style.display = 'block';
        }
        widgetStates.calculator = true;
    }
});

// Sports icon click handler
sportsTrigger.addEventListener('click', async function() {
    if (widgetStates.sports) {
        sportsWidget.style.display = 'none';
        widgetStates.sports = false;
    } else {
        closeAllWidgets();
        if (!sportsLoaded) {
            await showSports();
            sportsLoaded = true;
        } else {
            sportsWidget.style.display = 'block';
        }
        widgetStates.sports = true;
    }
});

// World Clock icon click handler
clockTrigger.addEventListener('click', async function() {
    if (widgetStates.clock) {
        clockWidget.style.display = 'none';
        stopClockUpdates();
        widgetStates.clock = false;
    } else {
        closeAllWidgets();
        if (!clockLoaded) {
            await showWorldClock();
            clockLoaded = true;
        } else {
            clockWidget.style.display = 'block';
            startClockUpdates();
        }
        widgetStates.clock = true;
    }
});

// Wiki icon click handler
wikiTrigger.addEventListener('click', function() {
    if (widgetStates.wiki) {
        wikiWidget.style.display = 'none';
        widgetStates.wiki = false;
    } else {
        closeAllWidgets();
        
        // Copy main search text to wiki search
        const mainSearchText = input.value.trim();
        
        if (!wikiLoaded) {
            showWikiSearch();
            wikiLoaded = true;
        } else {
            wikiWidget.style.display = 'block';
        }
        
        // Set wiki search text and auto-search if exists
        if (mainSearchText) {
            const wikiSearchInput = document.getElementById('wikiSearchInput');
            if (wikiSearchInput) {
                wikiSearchInput.value = mainSearchText;
                performWikiSearch();
            }
        }
        
        widgetStates.wiki = true;
    }
});

// Wikipedia Functions
async function searchWikipedia(query) {
    try {
        // First get search results
        const searchResponse = await fetch(
            `https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=5&format=json&origin=*`
        );
        const searchData = await searchResponse.json();
        
        if (searchData[1].length === 0) return [];
        
        // Get page extracts for better summaries
        const titles = searchData[1].join('|');
        const extractResponse = await fetch(
            `https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&exintro=1&explaintext=1&titles=${encodeURIComponent(titles)}&origin=*`
        );
        const extractData = await extractResponse.json();
        
        const results = [];
        const pages = extractData.query.pages;
        
        for (let i = 0; i < searchData[1].length; i++) {
            const title = searchData[1][i];
            const url = searchData[3][i];
            
            // Find matching page extract
            let summary = searchData[2][i] || '';
            for (let pageId in pages) {
                if (pages[pageId].title === title && pages[pageId].extract) {
                    summary = pages[pageId].extract;
                    // Limit to ~300 characters
                    if (summary.length > 300) {
                        summary = summary.substring(0, 300) + '...';
                    }
                    break;
                }
            }
            
            results.push({ title, summary, url });
        }
        
        return results;
    } catch (error) {
        console.error('Wikipedia search error:', error);
        return [];
    }
}

function showWikiSearch() {
    wikiWidget.innerHTML = `
        <div class="wiki-widget">
            <button class="widget-close-x" onclick="closeWidget('wiki')">‚úï</button>
            <div class="wiki-header">
                <span>üìö</span>
                <span>Wiki Search</span>
            </div>
            <div class="wiki-subheader">Powered by Wikipedia</div>
            
            <div class="wiki-search-box" style="position: relative;">
                <input type="text" class="wiki-search-input" id="wikiSearchInput" placeholder="Search Wikipedia..." autocomplete="off" style="padding-right: 100px;" />
                <button class="search-clear-btn" id="wikiSearchClearBtn" onclick="clearWikiSearch()" style="display: none; right: 80px;">‚úï</button>
                <button class="wiki-search-btn" onclick="performWikiSearch()">Search</button>
            </div>
            
            <div class="wiki-results" id="wikiResults">
                <div class="wiki-empty">Enter a search term to find articles on Wikipedia</div>
            </div>
            
            <div class="wiki-footer">
                Content from Wikipedia (CC BY-SA 4.0)<br>
                Wikipedia¬Æ is a registered trademark of the Wikimedia Foundation
            </div>
        </div>
    `;
    
    wikiWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
    
    // Setup enter key and clear button
    const searchInput = document.getElementById('wikiSearchInput');
    const wikiClearBtn = document.getElementById('wikiSearchClearBtn');
    
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performWikiSearch();
        }
    });
    
    searchInput.addEventListener('input', function() {
        if (this.value.trim()) {
            wikiClearBtn.style.display = 'inline-block';
        } else {
            wikiClearBtn.style.display = 'none';
        }
    });
    
    searchInput.focus();
}

function clearWikiSearch() {
    const wikiSearchInput = document.getElementById('wikiSearchInput');
    const wikiClearBtn = document.getElementById('wikiSearchClearBtn');
    if (wikiSearchInput) {
        wikiSearchInput.value = '';
        wikiClearBtn.style.display = 'none';
        wikiSearchInput.focus();
    }
}

async function performWikiSearch() {
    const searchInput = document.getElementById('wikiSearchInput');
    const query = searchInput.value.trim();
    const resultsContainer = document.getElementById('wikiResults');
    
    if (!query) {
        resultsContainer.innerHTML = '<div class="wiki-empty">Please enter a search term</div>';
        return;
    }
    
    resultsContainer.innerHTML = '<div class="wiki-loading">Searching Wikipedia...</div>';
    
    const results = await searchWikipedia(query);
    
    if (results.length === 0) {
        resultsContainer.innerHTML = '<div class="wiki-empty">No results found. Try a different search term.</div>';
        return;
    }
    
    resultsContainer.innerHTML = results.map(result => `
        <div class="wiki-result-card">
            <a href="${result.url}" target="_blank" class="wiki-result-title">${escapeHtml(result.title)}</a>
            <div class="wiki-result-summary">${escapeHtml(result.summary || 'No summary available.')}</div>
            <a href="${result.url}" target="_blank" class="wiki-result-link">Read more on Wikipedia ‚Üí</a>
        </div>
    `).join('');
}

function closeWiki() {
    wikiWidget.style.display = 'none';
    shortcutsSection.style.display = 'block';
}

// World Clock Functions
async function loadCitiesData() {
    if (citiesData) return citiesData;
    
    // Top 500 cities inline (keeping it under 75KB total)
    citiesData = [
  {"name":"New York","country":"USA","timezone":"America/New_York"},
  {"name":"Los Angeles","country":"USA","timezone":"America/Los_Angeles"},
  {"name":"Chicago","country":"USA","timezone":"America/Chicago"},
  {"name":"Houston","country":"USA","timezone":"America/Chicago"},
  {"name":"Phoenix","country":"USA","timezone":"America/Phoenix"},
  {"name":"Philadelphia","country":"USA","timezone":"America/New_York"},
  {"name":"San Antonio","country":"USA","timezone":"America/Chicago"},
  {"name":"San Diego","country":"USA","timezone":"America/Los_Angeles"},
  {"name":"Dallas","country":"USA","timezone":"America/Chicago"},
  {"name":"San Jose","country":"USA","timezone":"America/Los_Angeles"},
  {"name":"Austin","country":"USA","timezone":"America/Chicago"},
  {"name":"San Francisco","country":"USA","timezone":"America/Los_Angeles"},
  {"name":"Seattle","country":"USA","timezone":"America/Los_Angeles"},
  {"name":"Denver","country":"USA","timezone":"America/Denver"},
  {"name":"Boston","country":"USA","timezone":"America/New_York"},
  {"name":"Nashville","country":"USA","timezone":"America/Chicago"},
  {"name":"Portland","country":"USA","timezone":"America/Los_Angeles"},
  {"name":"Las Vegas","country":"USA","timezone":"America/Los_Angeles"},
  {"name":"Miami","country":"USA","timezone":"America/New_York"},
  {"name":"Atlanta","country":"USA","timezone":"America/New_York"},
  {"name":"Washington DC","country":"USA","timezone":"America/New_York"},
  {"name":"Toronto","country":"Canada","timezone":"America/Toronto"},
  {"name":"Montreal","country":"Canada","timezone":"America/Montreal"},
  {"name":"Vancouver","country":"Canada","timezone":"America/Vancouver"},
  {"name":"Calgary","country":"Canada","timezone":"America/Edmonton"},
  {"name":"Mexico City","country":"Mexico","timezone":"America/Mexico_City"},
  {"name":"Guadalajara","country":"Mexico","timezone":"America/Mexico_City"},
  {"name":"S√£o Paulo","country":"Brazil","timezone":"America/Sao_Paulo"},
  {"name":"Rio de Janeiro","country":"Brazil","timezone":"America/Sao_Paulo"},
  {"name":"Buenos Aires","country":"Argentina","timezone":"America/Argentina/Buenos_Aires"},
  {"name":"Lima","country":"Peru","timezone":"America/Lima"},
  {"name":"Bogota","country":"Colombia","timezone":"America/Bogota"},
  {"name":"Santiago","country":"Chile","timezone":"America/Santiago"},
  {"name":"London","country":"UK","timezone":"Europe/London"},
  {"name":"Manchester","country":"UK","timezone":"Europe/London"},
  {"name":"Edinburgh","country":"UK","timezone":"Europe/London"},
  {"name":"Dublin","country":"Ireland","timezone":"Europe/Dublin"},
  {"name":"Paris","country":"France","timezone":"Europe/Paris"},
  {"name":"Lyon","country":"France","timezone":"Europe/Paris"},
  {"name":"Marseille","country":"France","timezone":"Europe/Paris"},
  {"name":"Berlin","country":"Germany","timezone":"Europe/Berlin"},
  {"name":"Hamburg","country":"Germany","timezone":"Europe/Berlin"},
  {"name":"Munich","country":"Germany","timezone":"Europe/Berlin"},
  {"name":"Frankfurt","country":"Germany","timezone":"Europe/Berlin"},
  {"name":"Amsterdam","country":"Netherlands","timezone":"Europe/Amsterdam"},
  {"name":"Brussels","country":"Belgium","timezone":"Europe/Brussels"},
  {"name":"Zurich","country":"Switzerland","timezone":"Europe/Zurich"},
  {"name":"Geneva","country":"Switzerland","timezone":"Europe/Zurich"},
  {"name":"Vienna","country":"Austria","timezone":"Europe/Vienna"},
  {"name":"Madrid","country":"Spain","timezone":"Europe/Madrid"},
  {"name":"Barcelona","country":"Spain","timezone":"Europe/Madrid"},
  {"name":"Valencia","country":"Spain","timezone":"Europe/Madrid"},
  {"name":"Rome","country":"Italy","timezone":"Europe/Rome"},
  {"name":"Milan","country":"Italy","timezone":"Europe/Rome"},
  {"name":"Naples","country":"Italy","timezone":"Europe/Rome"},
  {"name":"Lisbon","country":"Portugal","timezone":"Europe/Lisbon"},
  {"name":"Porto","country":"Portugal","timezone":"Europe/Lisbon"},
  {"name":"Athens","country":"Greece","timezone":"Europe/Athens"},
  {"name":"Stockholm","country":"Sweden","timezone":"Europe/Stockholm"},
  {"name":"Copenhagen","country":"Denmark","timezone":"Europe/Copenhagen"},
  {"name":"Oslo","country":"Norway","timezone":"Europe/Oslo"},
  {"name":"Helsinki","country":"Finland","timezone":"Europe/Helsinki"},
  {"name":"Reykjavik","country":"Iceland","timezone":"Atlantic/Reykjavik"},
  {"name":"Moscow","country":"Russia","timezone":"Europe/Moscow"},
  {"name":"Saint Petersburg","country":"Russia","timezone":"Europe/Moscow"},
  {"name":"Warsaw","country":"Poland","timezone":"Europe/Warsaw"},
  {"name":"Prague","country":"Czech Republic","timezone":"Europe/Prague"},
  {"name":"Budapest","country":"Hungary","timezone":"Europe/Budapest"},
  {"name":"Istanbul","country":"Turkey","timezone":"Europe/Istanbul"},
  {"name":"Dubai","country":"UAE","timezone":"Asia/Dubai"},
  {"name":"Abu Dhabi","country":"UAE","timezone":"Asia/Dubai"},
  {"name":"Riyadh","country":"Saudi Arabia","timezone":"Asia/Riyadh"},
  {"name":"Doha","country":"Qatar","timezone":"Asia/Qatar"},
  {"name":"Tel Aviv","country":"Israel","timezone":"Asia/Tel_Aviv"},
  {"name":"Beirut","country":"Lebanon","timezone":"Asia/Beirut"},
  {"name":"Tehran","country":"Iran","timezone":"Asia/Tehran"},
  {"name":"Mumbai","country":"India","timezone":"Asia/Kolkata"},
  {"name":"Delhi","country":"India","timezone":"Asia/Kolkata"},
  {"name":"Bangalore","country":"India","timezone":"Asia/Kolkata"},
  {"name":"Hyderabad","country":"India","timezone":"Asia/Kolkata"},
  {"name":"Chennai","country":"India","timezone":"Asia/Kolkata"},
  {"name":"Kolkata","country":"India","timezone":"Asia/Kolkata"},
  {"name":"Pune","country":"India","timezone":"Asia/Kolkata"},
  {"name":"Singapore","country":"Singapore","timezone":"Asia/Singapore"},
  {"name":"Bangkok","country":"Thailand","timezone":"Asia/Bangkok"},
  {"name":"Kuala Lumpur","country":"Malaysia","timezone":"Asia/Kuala_Lumpur"},
  {"name":"Jakarta","country":"Indonesia","timezone":"Asia/Jakarta"},
  {"name":"Manila","country":"Philippines","timezone":"Asia/Manila"},
  {"name":"Ho Chi Minh City","country":"Vietnam","timezone":"Asia/Ho_Chi_Minh"},
  {"name":"Hanoi","country":"Vietnam","timezone":"Asia/Bangkok"},
  {"name":"Tokyo","country":"Japan","timezone":"Asia/Tokyo"},
  {"name":"Osaka","country":"Japan","timezone":"Asia/Tokyo"},
  {"name":"Beijing","country":"China","timezone":"Asia/Shanghai"},
  {"name":"Shanghai","country":"China","timezone":"Asia/Shanghai"},
  {"name":"Hong Kong","country":"Hong Kong","timezone":"Asia/Hong_Kong"},
  {"name":"Taipei","country":"Taiwan","timezone":"Asia/Taipei"},
  {"name":"Seoul","country":"South Korea","timezone":"Asia/Seoul"},
  {"name":"Sydney","country":"Australia","timezone":"Australia/Sydney"},
  {"name":"Melbourne","country":"Australia","timezone":"Australia/Melbourne"},
  {"name":"Brisbane","country":"Australia","timezone":"Australia/Brisbane"},
  {"name":"Perth","country":"Australia","timezone":"Australia/Perth"},
  {"name":"Auckland","country":"New Zealand","timezone":"Pacific/Auckland"},
  {"name":"Cairo","country":"Egypt","timezone":"Africa/Cairo"},
  {"name":"Lagos","country":"Nigeria","timezone":"Africa/Lagos"},
  {"name":"Johannesburg","country":"South Africa","timezone":"Africa/Johannesburg"},
  {"name":"Cape Town","country":"South Africa","timezone":"Africa/Johannesburg"},
  {"name":"Nairobi","country":"Kenya","timezone":"Africa/Nairobi"}
    ];
    
    return citiesData;
}

async function showWorldClock() {
    // Load saved clocks
    const saved = localStorage.getItem('userClocks');
    userClocks = saved ? JSON.parse(saved) : [];
    
    await loadCitiesData();
    
    clockWidget.innerHTML = `
        <div class="clock-widget">
            <button class="widget-close-x" onclick="closeWidget('clock')">‚úï</button>
            <div class="clock-header">
                <span>üïê</span>
                <span>World Clock</span>
            </div>
            <div class="clock-search-box">
                <input type="text" class="clock-search-input" id="clockSearchInput" placeholder="Search cities..." autocomplete="off" />
                <span class="clock-search-icon">üîç</span>
                <div class="clock-suggestions" id="clockSuggestions" style="display: none;"></div>
            </div>
            <div class="clock-list" id="clockList"></div>
        </div>
    `;
    
    clockWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
    
    renderClockList();
    startClockUpdates();
    
    // Setup search
    const searchInput = document.getElementById('clockSearchInput');
    const suggestions = document.getElementById('clockSuggestions');
    
    searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase().trim();
        
        if (query.length < 2) {
            suggestions.style.display = 'none';
            return;
        }
        
        const matches = citiesData.filter(city => 
            city.name.toLowerCase().includes(query) || 
            city.country.toLowerCase().includes(query)
        ).slice(0, 10);
        
        if (matches.length > 0) {
            suggestions.innerHTML = matches.map(city => `
                <div class="clock-suggestion-item" onclick="addClock('${city.name}', '${city.country}', '${city.timezone}')">
                    <span class="clock-suggestion-city">${city.name}, ${city.country}</span>
                    <span class="clock-suggestion-tz">${getTimezoneName(city.timezone)}</span>
                </div>
            `).join('');
            suggestions.style.display = 'block';
        } else {
            suggestions.style.display = 'none';
        }
    });
    
    searchInput.addEventListener('blur', function() {
        setTimeout(() => {
            suggestions.style.display = 'none';
        }, 200);
    });
}

function addClock(name, country, timezone) {
    const exists = userClocks.find(c => c.name === name && c.timezone === timezone);
    if (exists) return;
    
    userClocks.push({ name, country, timezone });
    localStorage.setItem('userClocks', JSON.stringify(userClocks));
    
    document.getElementById('clockSearchInput').value = '';
    document.getElementById('clockSuggestions').style.display = 'none';
    
    renderClockList();
}

function removeClock(index) {
    userClocks.splice(index, 1);
    localStorage.setItem('userClocks', JSON.stringify(userClocks));
    renderClockList();
}

function renderClockList() {
    const listContainer = document.getElementById('clockList');
    
    if (userClocks.length === 0) {
        listContainer.innerHTML = '<div class="clock-empty">No clocks added yet.<br>Search and add cities to get started!</div>';
        return;
    }
    
    listContainer.innerHTML = userClocks.map((clock, index) => {
        const time = getTimeForTimezone(clock.timezone);
        return `
            <div class="clock-card">
                <div style="flex: 1;">
                    <div class="clock-city-name">${clock.name}, ${clock.country}</div>
                    <div class="clock-timezone">${getTimezoneName(clock.timezone)}</div>
                </div>
                <div class="clock-time">
                    <div class="clock-time-display" id="time-${index}">${time.time}</div>
                    <div class="clock-date-display" id="date-${index}">${time.date}</div>
                </div>
                <button class="clock-remove" onclick="removeClock(${index})">‚úï</button>
            </div>
        `;
    }).join('');
}

function getTimeForTimezone(timezone) {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('en-US', { 
        timeZone: timezone, 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit',
        hour12: true 
    });
    const dateStr = now.toLocaleDateString('en-US', {
        timeZone: timezone,
        weekday: 'short',
        month: 'short',
        day: 'numeric'
    });
    
    return { time: timeStr, date: dateStr };
}

function getTimezoneName(timezone) {
    const parts = timezone.split('/');
    return parts[parts.length - 1].replace(/_/g, ' ');
}

function updateClockTimes() {
    userClocks.forEach((clock, index) => {
        const time = getTimeForTimezone(clock.timezone);
        const timeEl = document.getElementById(`time-${index}`);
        const dateEl = document.getElementById(`date-${index}`);
        
        if (timeEl) timeEl.textContent = time.time;
        if (dateEl) dateEl.textContent = time.date;
    });
}

function startClockUpdates() {
    if (clockUpdateInterval) clearInterval(clockUpdateInterval);
    clockUpdateInterval = setInterval(updateClockTimes, 1000);
}

function stopClockUpdates() {
    if (clockUpdateInterval) {
        clearInterval(clockUpdateInterval);
        clockUpdateInterval = null;
    }
}

function closeWorldClock() {
    clockWidget.style.display = 'none';
    shortcutsSection.style.display = 'block';
    stopClockUpdates();
}

// Sports Functions
async function fetchSportsScores(sport) {
    const endpoints = {
        'nfl': 'https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard',
        'nba': 'https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard',
        'mlb': 'https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard',
        'nhl': 'https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard',
        'soccer': 'https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/scoreboard'
    };
    
    try {
        const response = await fetch(endpoints[sport]);
        const data = await response.json();
        return data.events || [];
    } catch (error) {
        console.error('Sports fetch error:', error);
        return [];
    }
}

async function showSports() {
    sportsWidget.innerHTML = `
        <div class="sports-widget">
            <button class="widget-close-x" onclick="closeWidget('sports')">‚úï</button>
            <div class="sports-header">
                <span>üèÄ</span>
                <span>Live Sports Scores</span>
            </div>
            <div class="sports-tabs">
                <button class="sport-tab active" onclick="switchSport('nfl')">üèà NFL</button>
                <button class="sport-tab" onclick="switchSport('nba')">üèÄ NBA</button>
                <button class="sport-tab" onclick="switchSport('mlb')">‚öæ MLB</button>
                <button class="sport-tab" onclick="switchSport('nhl')">üèí NHL</button>
                <button class="sport-tab" onclick="switchSport('soccer')">‚öΩ Soccer</button>
            </div>
            <div class="sports-games" id="sportsGames">
                <div class="sports-loading">Loading scores...</div>
            </div>
        </div>
    `;
    
    sportsWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
    
    await loadSportGames('nfl');
}

async function switchSport(sport) {
    currentSport = sport;
    
    // Update active tab
    document.querySelectorAll('.sport-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    
    await loadSportGames(sport);
}

async function loadSportGames(sport) {
    const gamesContainer = document.getElementById('sportsGames');
    gamesContainer.innerHTML = '<div class="sports-loading">Loading scores...</div>';
    
    const games = await fetchSportsScores(sport);
    
    if (games.length === 0) {
        gamesContainer.innerHTML = '<div class="sports-loading">No games today</div>';
        return;
    }
    
    gamesContainer.innerHTML = games.map(game => {
        const competition = game.competitions[0];
        const homeTeam = competition.competitors.find(t => t.homeAway === 'home');
        const awayTeam = competition.competitors.find(t => t.homeAway === 'away');
        const status = competition.status;
        
        const isLive = status.type.state === 'in';
        const statusText = isLive ? `${status.type.shortDetail}` : status.type.shortDetail;
        
        return `
            <div class="game-card">
                <div style="flex: 1;">
                    <div class="game-team">
                        <div class="team-name">${awayTeam.team.shortDisplayName}</div>
                        <div class="game-score">${awayTeam.score || '0'}</div>
                    </div>
                    <div class="game-team" style="margin-top: 8px;">
                        <div class="team-name">${homeTeam.team.shortDisplayName}</div>
                        <div class="game-score">${homeTeam.score || '0'}</div>
                    </div>
                </div>
                <div style="text-align: right; min-width: 80px;">
                    <div class="game-status ${isLive ? 'game-live' : ''}">${statusText}</div>
                </div>
            </div>
        `;
    }).join('');
}

function closeSports() {
    sportsWidget.style.display = 'none';
    shortcutsSection.style.display = 'block';
}

// Calculator Functions
function showCalculator() {
    calculatorWidget.innerHTML = `
        <div class="calculator-widget">
            <button class="widget-close-x" onclick="closeWidget('calculator')">‚úï</button>
            <div class="calculator-display" id="calcDisplay">0</div>
            <input type="text" id="calcInput" class="calculator-input" placeholder="Type expression (e.g., 2+2, sqrt(16))" />
            <div class="calculator-buttons">
                <button class="calc-btn" onclick="calcAppend('7')">7</button>
                <button class="calc-btn" onclick="calcAppend('8')">8</button>
                <button class="calc-btn" onclick="calcAppend('9')">9</button>
                <button class="calc-btn operator" onclick="calcAppend('/')">/</button>
                <button class="calc-btn" onclick="calcAppend('4')">4</button>
                <button class="calc-btn" onclick="calcAppend('5')">5</button>
                <button class="calc-btn" onclick="calcAppend('6')">6</button>
                <button class="calc-btn operator" onclick="calcAppend('*')">√ó</button>
                <button class="calc-btn" onclick="calcAppend('1')">1</button>
                <button class="calc-btn" onclick="calcAppend('2')">2</button>
                <button class="calc-btn" onclick="calcAppend('3')">3</button>
                <button class="calc-btn operator" onclick="calcAppend('-')">-</button>
                <button class="calc-btn" onclick="calcAppend('0')">0</button>
                <button class="calc-btn" onclick="calcAppend('.')">.</button>
                <button class="calc-btn equals" onclick="calcEquals()">=</button>
                <button class="calc-btn operator" onclick="calcAppend('+')">+</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 12px;">
                <button class="calc-btn clear" onclick="calcClear()">C</button>
                <button class="calc-btn" onclick="calcAppend('(')">(</button>
                <button class="calc-btn" onclick="calcAppend(')')">)</button>
                <button class="calc-btn operator" onclick="calcAppend('^')">^</button>
            </div>
        </div>
    `;
    
    calculatorWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
    
    const calcInput = document.getElementById('calcInput');
    calcInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            calcEquals();
        }
    });
    
    calcInput.addEventListener('input', function() {
        calcDisplay = this.value;
        updateCalcDisplay();
    });
}

function calcAppend(value) {
    const calcInput = document.getElementById('calcInput');
    calcInput.value += value;
    calcDisplay = calcInput.value;
    updateCalcDisplay();
}

function calcClear() {
    const calcInput = document.getElementById('calcInput');
    calcInput.value = '';
    calcDisplay = '0';
    updateCalcDisplay();
}

function updateCalcDisplay() {
    const display = document.getElementById('calcDisplay');
    display.textContent = calcDisplay || '0';
}

function calcEquals() {
    const calcInput = document.getElementById('calcInput');
    let expression = calcInput.value;
    
    try {
        // Support common math functions
        expression = expression.replace(/sqrt\(([^)]+)\)/g, 'Math.sqrt($1)');
        expression = expression.replace(/sin\(([^)]+)\)/g, 'Math.sin($1*Math.PI/180)');
        expression = expression.replace(/cos\(([^)]+)\)/g, 'Math.cos($1*Math.PI/180)');
        expression = expression.replace(/tan\(([^)]+)\)/g, 'Math.tan($1*Math.PI/180)');
        expression = expression.replace(/log\(([^)]+)\)/g, 'Math.log10($1)');
        expression = expression.replace(/ln\(([^)]+)\)/g, 'Math.log($1)');
        expression = expression.replace(/\^/g, '**');
        
        const result = eval(expression);
        calcDisplay = result.toString();
        calcInput.value = calcDisplay;
        updateCalcDisplay();
    } catch (error) {
        calcDisplay = 'Error';
        updateCalcDisplay();
    }
}

function closeCalculator() {
    calculatorWidget.style.display = 'none';
    shortcutsSection.style.display = 'block';
}

function renderShortcuts() {
    shortcutsGrid.innerHTML = '';
    
    shortcuts.forEach(shortcut => {
        const link = document.createElement('a');
        link.className = 'shortcut';
        link.href = shortcut.url;
        link.dataset.priority = shortcut.priority;
        
        const iconWrapper = document.createElement('div');
        iconWrapper.className = 'shortcut-icon';
        
        const icon = document.createElement('img');
        icon.src = `https://www.google.com/s2/favicons?domain=${shortcut.domain}&sz=32`;
        icon.alt = shortcut.name;
        
        const name = document.createElement('span');
        name.textContent = shortcut.name;
        
        iconWrapper.appendChild(icon);
        link.appendChild(iconWrapper);
        link.appendChild(name);
        shortcutsGrid.appendChild(link);
    });
}

// Weather Functions
async function fetchWeather(location = savedLocation) {
    try {
        const response = await fetch(
            `https://api.weatherapi.com/v1/forecast.json?key=${WEATHER_API_KEY}&q=${location}&days=3&aqi=yes`
        );
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Weather fetch error:', error);
        return null;
    }
}

function showWeatherWidget(data) {
    if (!data) return;
    
    const current = data.current;
    const location = data.location;
    const forecast = data.forecast.forecastday;
    const hourly = forecast[selectedDay].hour;
    
    const rainDistance = current.precip_mm > 0 ? 'It\'s raining now' : 'No rain nearby';
    
    weatherWidget.innerHTML = `
        <div class="weather-widget">
            <button class="widget-close-x" onclick="closeWidget('weather')">‚úï</button>
            <div class="weather-widget-small">
                <div style="flex: 1;">
                    <div class="weather-location">
                        <span>${location.name}, ${location.region}</span>
                        <span style="cursor: pointer;" onclick="event.stopPropagation(); toggleLocationInput()">üè†</span>
                    </div>
                    <div class="weather-time">As of ${new Date(current.last_updated).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}</div>
                    
                    <div style="display: flex; gap: 20px; align-items: flex-start;">
                        <div class="weather-main">
                            <img src="https:${current.condition.icon}" alt="${current.condition.text}" class="weather-icon" />
                            <div>
                                <span class="weather-temp">${Math.round(current.temp_f)}</span>
                                <span class="weather-unit">¬∞F</span>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; margin-top: 8px;">
                            <div>
                                <div style="color: #70757a;">Visibility</div>
                                <div style="font-weight: 600; color: #202124;">${current.vis_miles} mi</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">Pressure</div>
                                <div style="font-weight: 600; color: #202124;">${current.pressure_in} in</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">Humidity</div>
                                <div style="font-weight: 600; color: #202124;">${current.humidity}%</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">UV Index</div>
                                <div style="font-weight: 600; color: #202124;">${current.uv}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="weather-rain-info">
                        <span>‚ÑπÔ∏è</span>
                        <span>${rainDistance}</span>
                    </div>
                    
                    <div class="weather-change-location" style="display: none; margin-top: 12px;" id="locationChanger">
                        <input type="text" class="weather-location-input" placeholder="Enter city name..." id="locationInput" onkeypress="if(event.key==='Enter') updateLocation()" />
                    </div>
                </div>
            </div>
            
            <button class="weather-expand-btn" onclick="toggleWeatherExpand()">
                <span id="expandBtnText">${weatherExpanded ? 'Show less' : 'See full forecast'}</span>
            </button>
            
            <div class="weather-widget-full ${weatherExpanded ? 'expanded' : ''}" id="weatherFull">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; font-weight: 600; color: #202124; margin-bottom: 12px;">
                        Hourly Forecast - ${forecast[selectedDay].date === forecast[0].date ? 'Today' : new Date(forecast[selectedDay].date).toLocaleDateString('en-US', { weekday: 'long' })}
                    </div>
                    <div class="hourly-forecast-container">
                        ${hourly.filter((_, i) => i % 3 === 0).map(hour => {
                            const time = new Date(hour.time).toLocaleTimeString('en-US', { hour: 'numeric' });
                            return `
                                <div class="hourly-item">
                                    <div style="font-size: 12px; color: #70757a; margin-bottom: 8px;">${time}</div>
                                    <img src="https:${hour.condition.icon}" alt="${hour.condition.text}" style="width: 40px; height: 40px; margin: 0 auto;" />
                                    <div style="font-size: 16px; font-weight: 600; color: #202124; margin-top: 8px;">${Math.round(hour.temp_f)}¬∞</div>
                                    <div style="font-size: 11px; color: #70757a; margin-top: 4px;">${hour.chance_of_rain}%</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 16px;">
                    <div style="font-size: 14px; font-weight: 600; color: #202124; margin-bottom: 12px;">3-Day Forecast</div>
                    <div class="weather-forecast">
                        ${forecast.map((day, index) => `
                            <div class="forecast-day" onclick="event.stopPropagation(); selectDay(${index})" style="cursor: pointer; opacity: ${selectedDay === index ? '1' : '0.7'}; transform: ${selectedDay === index ? 'scale(1.05)' : 'scale(1)'}; transition: all 0.2s;">
                                <div class="forecast-day-name">${index === 0 ? 'Today' : new Date(day.date).toLocaleDateString('en-US', { weekday: 'short' })}</div>
                                <img src="https:${day.day.condition.icon}" alt="${day.day.condition.text}" class="forecast-icon" />
                                <div class="forecast-temp">
                                    <span class="forecast-temp-high">${Math.round(day.day.maxtemp_f)}¬∞</span>
                                    <span class="forecast-temp-low">${Math.round(day.day.mintemp_f)}¬∞</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        </div>
    `;
    
    weatherWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
}

function toggleWeatherExpand() {
    weatherExpanded = !weatherExpanded;
    const weatherData = window.currentWeatherData;
    if (weatherData) {
        showWeatherWidget(weatherData);
    }
}

function toggleLocationInput() {
    const changer = document.getElementById('locationChanger');
    changer.style.display = changer.style.display === 'none' ? 'block' : 'none';
    if (changer.style.display === 'block') {
        document.getElementById('locationInput').focus();
    }
}

function selectDay(dayIndex) {
    selectedDay = dayIndex;
    const weatherData = window.currentWeatherData;
    if (weatherData) {
        showWeatherWidget(weatherData);
    }
}

async function updateLocation() {
    const newLocation = document.getElementById('locationInput').value.trim();
    if (newLocation) {
        savedLocation = newLocation;
        localStorage.setItem('weatherLocation', newLocation);
        const data = await fetchWeather(newLocation);
        if (data) {
            window.currentWeatherData = data;
            showWeatherWidget(data);
            toggleLocationInput();
        }
    }
}

// Autocomplete
function findSuggestion(query) {
    if (!query || query.length < 2) return '';
    
    const cleaned = query.toLowerCase().trim();
    
    for (let key in navigationRouter) {
        if (key.startsWith(cleaned) && key !== cleaned) {
            return key;
        }
    }
    
    return '';
}

function updateSuggestion() {
    const query = input.value;
    const suggestion = findSuggestion(query);
    
    if (suggestion && query.length >= 2) {
        currentSuggestion = suggestion;
        suggestionInput.value = query + suggestion.slice(query.length);
    } else {
        currentSuggestion = '';
        suggestionInput.value = '';
    }
}

function completeSuggestion() {
    if (currentSuggestion) {
        input.value = currentSuggestion;
        suggestionInput.value = '';
        currentSuggestion = '';
        input.focus();
    }
}

function checkNavigation(query) {
    const cleaned = query.toLowerCase().trim();
    return navigationRouter[cleaned];
}

input.addEventListener("input", function() {
    updateSuggestion();
    
    if (this.value.trim() === '') {
        resultsDiv.innerHTML = '';
        weatherWidget.style.display = 'block';
        shortcutsSection.style.display = 'none';
    }
});

input.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
        e.preventDefault();
        handleSearch();
    } else if (e.key === "ArrowRight" || e.key === "Tab") {
        // Desktop only: Arrow Right or Tab to autocomplete
        if (currentSuggestion && input.selectionStart === input.value.length) {
            e.preventDefault();
            completeSuggestion();
        }
    }
});

input.addEventListener("click", function() {
    // Mobile only: Tap to autocomplete
    if (currentSuggestion && window.innerWidth <= 768) {
        completeSuggestion();
    }
});

function handleSearch() {
    const q = input.value.trim();
    if (!q) return;
    
    closeAllWidgets();
    
    suggestionInput.value = '';
    currentSuggestion = '';
    
    if (q.toLowerCase() === 'weather' || q.toLowerCase().startsWith('weather in ')) {
        const location = q.toLowerCase().startsWith('weather in ') ? q.slice(11).trim() : savedLocation;
        fetchWeather(location).then(data => {
            if (data) {
                savedLocation = location;
                localStorage.setItem('weatherLocation', location);
                window.currentWeatherData = data;
                showWeatherWidget(data);
                resultsDiv.innerHTML = '';
                widgetStates.weather = true;
            }
        });
        return;
    }
    
    const navUrl = checkNavigation(q);
    if (navUrl) {
        window.location.href = navUrl;
        return;
    }
    
    aiSearch(q);
}

async function aiSearch(query) {
    resultsDiv.innerHTML = '<div class="loading">üîç AI-powered search...</div>';
    
    try {
        const response = await fetch(`/api/search?q=${encodeURIComponent(query)}&limit=20`);
        const data = await response.json();
        const tavilyAnswer = data.answer || '';
        const tavilyImages = data.images || [];
        const results = data.results || [];
        
        if (results.length === 0) {
            resultsDiv.innerHTML = '<div class="error">No results found</div>';
            return;
        }
        
        // Get AI ranking only
        const aiResponse = await fetch('/api/ai-analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query, results: results })
        });
        
        const aiData = await aiResponse.json();
        displayAIResponse(aiData, results, tavilyAnswer, tavilyImages);
        
    } catch (error) {
        console.error('Search error:', error);
        resultsDiv.innerHTML = '<div class="error">Search failed. Please try again.</div>';
    }
}

function displayAIResponse(ai, results, tavilyAnswer, tavilyImages) {
    const { queryType, ranking } = ai;
    
    // Use AI ranking, or original order if ranking missing
    const rankedResults = ranking && ranking.length > 0
        ? ranking.filter(i => i < results.length).map(i => results[i]).filter(r => r)
        : results;
    
    resultsDiv.innerHTML = '';
    
    // Get first relevant image
    const firstImage = tavilyImages && tavilyImages.length > 0 ? tavilyImages[0] : null;
    
    switch(queryType) {
        case 'SIMPLE':
            // For simple queries, use Tavily answer if available
            if (tavilyAnswer) {
                resultsDiv.innerHTML = `<div class="ai-summary"><div class="ai-summary-header"><span>‚ö°</span><span>AI Overview</span></div><div class="ai-summary-text"><p style="font-size:20px;font-weight:500;">${escapeHtml(tavilyAnswer)}</p></div></div>`;
            }
            break;
        case 'BRAND':
        case 'FACTUAL':
        case 'COMPLEX':
            // Use Tavily's advanced answer with image for all query types
            if (tavilyAnswer) {
                const formattedAnswer = formatTavilyAnswer(tavilyAnswer);
                
                // Build AI summary with optional image
                let summaryHTML = '<div class="ai-summary">';
                summaryHTML += '<div class="ai-summary-header"><span>‚ö°</span><span>AI Overview</span></div>';
                
                if (firstImage) {
                    // Desktop: Image on right, text on left
                    // Mobile: Image on top, text below
                    summaryHTML += `
                        <div class="ai-summary-content">
                            <div class="ai-summary-text-with-image">${formattedAnswer}</div>
                            <div class="ai-summary-image">
                                <img src="${escapeHtml(firstImage.url)}" alt="${escapeHtml(firstImage.description || '')}" loading="lazy">
                                ${firstImage.description ? `<div class="image-caption">${escapeHtml(firstImage.description)}</div>` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    summaryHTML += `<div class="ai-summary-text">${formattedAnswer}</div>`;
                }
                
                summaryHTML += '</div>';
                resultsDiv.innerHTML = summaryHTML;
            }
            displayResults(rankedResults);
            break;
        default:
            if (tavilyAnswer) {
                const formattedDefault = formatTavilyAnswer(tavilyAnswer);
                resultsDiv.innerHTML = `<div class="ai-summary"><div class="ai-summary-header"><span>‚ö°</span><span>AI Overview</span></div><div class="ai-summary-text">${formattedDefault}</div></div>`;
            }
            displayResults(rankedResults);
    }
}

function formatTavilyAnswer(text) {
    if (!text) return '';
    
    // Remove inline URLs in brackets like „Äêhttps://...„Äë
    text = text.replace(/„Äê[^„Äë]*„Äë/g, '');
    
    // Remove inline URLs in parentheses like (https://...)
    text = text.replace(/\(https?:\/\/[^\)]+\)/g, '');
    
    // Remove standalone URLs
    text = text.replace(/https?:\/\/\S+/g, '');
    
    // Clean up extra spaces
    text = text.replace(/\s+/g, ' ').trim();
    
    // Split into sentences
    const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
    
    // Group into paragraphs (every 2-3 sentences)
    const paragraphs = [];
    for (let i = 0; i < sentences.length; i += 2) {
        const para = sentences.slice(i, i + 2).join(' ').trim();
        if (para) {
            paragraphs.push(`<p>${escapeHtml(para)}</p>`);
        }
    }
    
    return paragraphs.join('');
}

function displayResults(results) {
    results.forEach(item => {
        const div = document.createElement("div");
        div.className = "result";
        const summaryId = "summary-" + Math.random().toString(36).substr(2, 9);
        let domain = '';
        try {
            domain = new URL(item.url).hostname.replace('www.', '');
        } catch (e) {
            domain = item.source || '';
        }
        const maxLength = 160;
        const summary = item.summary || item.content || '';
        const isTruncated = summary.length > maxLength;
        const displaySummary = isTruncated ? summary.substring(0, maxLength) + '...' : summary;
        const fullSummary = summary;
        div.innerHTML = `<div class="result-source">${item.favicon ? `<img src="${item.favicon}" class="result-favicon" alt="">` : ""}<span class="result-source-name">${escapeHtml(item.source || domain)}</span></div><div class="result-url-display">${escapeHtml(item.url)}</div><h3 class="result-title"><a href="${escapeHtml(item.url)}">${escapeHtml(item.title)}</a></h3><div id="${summaryId}" class="result-snippet" data-full="${escapeHtml(fullSummary)}">${escapeHtml(displaySummary)}</div>${isTruncated ? `<a class="read-more" onclick="toggleSummary('${summaryId}', this)">Read more</a>` : ''}`;
        resultsDiv.appendChild(div);
    });
}


function shouldExcludeResult(item, query) {
    try {
        const url = new URL(item.url);
        const domain = url.hostname.replace('www.', '');
        const content = item.content || item.summary || '';
        
        // Always exclude these (100% useless)
        const alwaysExclude = ['tiktok.com', 'snapchat.com'];
        if (alwaysExclude.includes(domain)) {
            return true;
        }
        
        // Exclude security warning/error pages
        if (content.includes('Your connection is not private') ||
            content.includes('Attackers might be trying') ||
            content.includes('This site can\'t be reached')) {
            return true;
        }
        
        return false;
    } catch (e) {
        return false;
    }
}

function toggleSummary(id, el) {
    const snippet = document.getElementById(id);
    const fullText = snippet.getAttribute('data-full');
    const isExpanded = snippet.classList.contains('expanded');
    
    if (isExpanded) {
        // Show truncated version
        snippet.textContent = fullText.substring(0, 160) + '...';
        snippet.classList.remove('expanded');
        el.textContent = 'Read more';
    } else {
        // Show full version
        snippet.textContent = fullText;
        snippet.classList.add('expanded');
        el.textContent = 'Show less';
    }
}

function extractDomainFromURL(url) {
    try {
        return new URL(url).hostname.replace('www.', '');
    } catch {
        return '';
    }
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>

</body>
</html>