<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search AI - Fast. Clean. No spam.</title>
<style>
body {
    font-family: arial, sans-serif;
    background: #fff;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 652px;
    margin: 20px auto;
    padding: 0 16px;
}

.header {
    text-align: center;
    margin-bottom: 30px;
}

.logo {
    font-size: 48px;
    font-weight: 400;
    color: #202124;
    margin-bottom: 4px;
    letter-spacing: -1px;
}

.tagline {
    font-size: 13px;
    color: #70757a;
    margin-bottom: 28px;
}

.search-box {
    width: 100%;
    max-width: 584px;
    padding: 13px 16px;
    font-size: 16px;
    border: 1px solid #dfe1e5;
    border-radius: 24px;
    outline: none;
    box-sizing: border-box;
    position: relative;
    background: transparent;
    z-index: 2;
    margin: 0 auto;
    display: block;
}

.search-box:hover {
    border-color: #ccc;
    box-shadow: 0 1px 6px rgba(32,33,36,.28);
}

.search-box:focus {
    border-color: transparent;
    box-shadow: 0 1px 6px rgba(32,33,36,.28);
}

.search-wrapper {
    position: relative;
    max-width: 584px;
    margin: 0 auto 20px;
}

.search-suggestion {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 13px 16px;
    font-size: 16px;
    border: 1px solid transparent;
    border-radius: 24px;
    color: #80868b;
    pointer-events: none;
    box-sizing: border-box;
    z-index: 1;
}

/* Widget Triggers */
.widget-triggers {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px auto;
}

.widget-icon {
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: all 0.2s;
    position: relative;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
}

.widget-icon:hover {
    background: #e8eaed;
    transform: scale(1.1);
}

.icon-emoji {
    font-size: 24px;
}

.widget-icon.hidden {
    display: none;
}

/* Tooltip */
.widget-icon::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: #202124;
    color: #fff;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}

.widget-icon:hover::after {
    opacity: 1;
}

/* Calculator Widget */
.calculator-widget {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 400px;
    margin: 20px auto;
}

.calculator-display {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 8px;
    padding: 16px;
    font-size: 24px;
    font-weight: 300;
    text-align: right;
    margin-bottom: 16px;
    color: #202124;
    min-height: 60px;
    word-wrap: break-word;
}

.calculator-input {
    width: 100%;
    padding: 12px;
    font-size: 18px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    outline: none;
    margin-bottom: 12px;
    box-sizing: border-box;
}

.calculator-input:focus {
    border-color: #1a73e8;
}

.calculator-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-bottom: 12px;
}

.calc-btn {
    padding: 16px;
    font-size: 18px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    background: #f8f9fa;
    cursor: pointer;
    transition: all 0.2s;
    font-family: arial, sans-serif;
}

.calc-btn:hover {
    background: #e8eaed;
}

.calc-btn:active {
    transform: scale(0.95);
}

.calc-btn.operator {
    background: #e8f0fe;
    color: #1a73e8;
    font-weight: 600;
}

.calc-btn.equals {
    background: #1a73e8;
    color: white;
    font-weight: 600;
}

.calc-btn.equals:hover {
    background: #1967d2;
}

.calc-btn.clear {
    background: #fce8e6;
    color: #d93025;
}

.calc-btn.clear:hover {
    background: #f5c8c6;
}

.calculator-close {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    width: 100%;
    margin-top: 12px;
    font-family: arial, sans-serif;
}

.calculator-close:hover {
    background: #f1f3f4;
}

/* Sports Widget */
.sports-widget {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 20px auto;
}

.sports-header {
    font-size: 18px;
    font-weight: 600;
    color: #202124;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.sports-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    overflow-x: auto;
}

.sport-tab {
    padding: 8px 16px;
    border-radius: 20px;
    background: #f8f9fa;
    border: 1px solid #dadce0;
    cursor: pointer;
    font-size: 14px;
    color: #5f6368;
    white-space: nowrap;
    transition: all 0.2s;
}

.sport-tab:hover {
    background: #e8eaed;
}

.sport-tab.active {
    background: #1a73e8;
    color: white;
    border-color: #1a73e8;
}

.sports-games {
    max-height: 400px;
    overflow-y: auto;
}

.game-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.game-team {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
}

.team-logo {
    width: 32px;
    height: 32px;
    border-radius: 4px;
}

.team-name {
    font-size: 15px;
    font-weight: 500;
    color: #202124;
}

.game-score {
    font-size: 20px;
    font-weight: 600;
    color: #202124;
    min-width: 40px;
    text-align: center;
}

.game-status {
    font-size: 12px;
    color: #5f6368;
    text-align: center;
    margin-top: 4px;
}

.game-live {
    color: #d93025;
    font-weight: 600;
}

.game-live::before {
    content: "‚óè ";
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.sports-loading {
    text-align: center;
    padding: 40px;
    color: #5f6368;
}

.sports-close {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    width: 100%;
    margin-top: 12px;
    font-family: arial, sans-serif;
}

.sports-close:hover {
    background: #f1f3f4;
}

/* Shortcuts */
.shortcuts-section {
    margin: 30px 0;
}

.shortcuts-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
}

.shortcut {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px;
    text-decoration: none;
    color: #202124;
    cursor: pointer;
}

.shortcut:hover {
    opacity: 0.8;
}

.shortcut-icon {
    width: 56px;
    height: 56px;
    background: #f1f3f4;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
}

.shortcut img {
    width: 32px;
    height: 32px;
}

.shortcut span {
    font-size: 13px;
    text-align: center;
}

.shortcut[data-priority="2"] {
    display: none;
}

/* Weather Widget */
.weather-widget {
    background: white;
    border-radius: 12px;
    padding: 16px 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 584px;
    margin: 20px auto;
    transition: all 0.2s;
}

.weather-widget:hover {
    box-shadow: 0 2px 12px rgba(0,0,0,0.15);
}

.weather-widget-small {
    display: flex;
    align-items: center;
    gap: 16px;
}

.weather-location {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 16px;
    font-weight: 600;
    color: #202124;
    margin-bottom: 4px;
}

.weather-time {
    font-size: 12px;
    color: #70757a;
    margin-bottom: 8px;
}

.weather-main {
    display: flex;
    align-items: center;
    gap: 12px;
}

.weather-icon {
    width: 64px;
    height: 64px;
}

.weather-temp {
    font-size: 48px;
    font-weight: 300;
    color: #202124;
}

.weather-unit {
    font-size: 24px;
    color: #70757a;
}

.weather-condition {
    font-size: 18px;
    color: #202124;
    margin-left: auto;
}

.weather-rain-info {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: #1a73e8;
    margin-top: 8px;
}

.weather-expand-btn {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    margin-top: 12px;
    width: 100%;
    font-family: arial, sans-serif;
}

.weather-expand-btn:hover {
    background: #f1f3f4;
}

.weather-widget-full {
    display: none;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #dadce0;
}

.weather-widget-full.expanded {
    display: block;
}

.weather-forecast {
    display: flex;
    gap: 12px;
    padding: 12px 0;
}

.forecast-day {
    text-align: center;
    min-width: 80px;
}

.forecast-day-name {
    font-size: 12px;
    color: #70757a;
    margin-bottom: 8px;
}

.forecast-icon {
    width: 40px;
    height: 40px;
    margin: 0 auto;
}

.forecast-temp {
    font-size: 14px;
    color: #202124;
    margin-top: 8px;
}

.forecast-temp-high {
    font-weight: 600;
}

.forecast-temp-low {
    color: #70757a;
}

.weather-change-location {
    margin-top: 16px;
}

.weather-location-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #dadce0;
    border-radius: 20px;
    font-size: 14px;
    outline: none;
}

.weather-location-input:focus {
    border-color: #1a73e8;
}

/* Hourly forecast - single horizontal line on all devices */
.hourly-forecast-container {
    display: flex;
    overflow-x: auto;
    gap: 16px;
    padding: 12px 0;
    -webkit-overflow-scrolling: touch;
}

.hourly-forecast-container::-webkit-scrollbar {
    height: 4px;
}

.hourly-forecast-container::-webkit-scrollbar-track {
    background: #f1f3f4;
}

.hourly-forecast-container::-webkit-scrollbar-thumb {
    background: #dadce0;
    border-radius: 2px;
}

.hourly-item {
    flex-shrink: 0;
    text-align: center;
    min-width: 70px;
}

/* Results */
.results-container {
    margin-top: 20px;
}

.result {
    margin-bottom: 28px;
}

.result-url {
    display: flex;
    align-items: center;
    margin-bottom: 3px;
}

.result-url img {
    width: 18px;
    height: 18px;
    margin-right: 12px;
}

.result-url-text {
    font-size: 14px;
    line-height: 20px;
    color: #202124;
}

.result-title {
    margin: 0 0 3px 0;
    font-size: 20px;
    line-height: 26px;
}

.result-title a {
    color: #1a0dab;
    text-decoration: none;
}

.result-title a:visited {
    color: #681da8;
}

.result-title a:hover {
    text-decoration: underline;
}

.result-snippet {
    font-size: 14px;
    line-height: 22px;
    color: #4d5156;
    max-height: 44px;
    overflow: hidden;
}

.result-snippet.expanded {
    max-height: none;
}

.read-more {
    font-size: 14px;
    color: #1a0dab;
    cursor: pointer;
    margin-top: 4px;
    display: inline-block;
}

.read-more:hover {
    text-decoration: underline;
}

.loading {
    color: #70757a;
    padding: 20px 0;
}

.error {
    color: #d93025;
    padding: 20px 0;
}

/* Mobile Dark Mode */
@media (max-width: 768px) {
    body {
        background: #1a1a1a;
        color: #e8eaed;
    }
    
    .logo {
        color: #e8eaed;
    }
    
    .tagline {
        color: #9aa0a6;
    }
    
    .search-box {
        background: #2d2d2d;
        border: 1px solid #3c4043;
        color: #e8eaed;
    }
    
    .search-box::placeholder {
        color: #9aa0a6;
    }
    
    .search-suggestion {
        color: #5f6368;
    }
    
    .result {
        background: #2d2d2d;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 12px;
    }
    
    .result-url-text {
        color: #9aa0a6;
    }
    
    .result-title a {
        color: #8ab4f8;
    }
    
    .result-title a:visited {
        color: #c58af9;
    }
    
    .result-snippet {
        color: #bdc1c6;
    }
    
    .read-more {
        color: #8ab4f8;
    }
    
    .loading {
        color: #9aa0a6;
    }
    
    .error {
        color: #f28b82;
    }
    
    /* Weather widget dark mode */
    .weather-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
        max-width: 100%;
        margin: 20px 0;
    }
    
    .weather-location,
    .weather-temp {
        color: #e8eaed;
    }
    
    .weather-time,
    .weather-unit,
    .forecast-day-name,
    .forecast-temp-low {
        color: #9aa0a6;
    }
    
    .weather-expand-btn {
        background: #3c4043 !important;
        border-color: #5f6368 !important;
        color: #e8eaed !important;
    }
    
    .weather-widget-full {
        border-top-color: #5f6368;
    }
    
    /* Mobile hourly forecast scrollbar */
    .hourly-forecast-container::-webkit-scrollbar-track {
        background: transparent;
    }
    
    .hourly-forecast-container::-webkit-scrollbar-thumb {
        background: #5f6368;
    }
    
    .weather-location-input {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .shortcut {
        color: #e8eaed;
    }
    
    .shortcut-icon {
        background: #3c4043;
    }
    
    /* Widget icons dark mode */
    .widget-icon {
        background: #3c4043;
    }
    
    .widget-icon:hover {
        background: #5f6368;
    }
    
    .widget-icon::after {
        background: #5f6368;
    }
    
    /* Calculator dark mode */
    .calculator-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
    }
    
    .calculator-display {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .calculator-input {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .calculator-input::placeholder {
        color: #9aa0a6;
    }
    
    .calc-btn {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .calc-btn:hover {
        background: #5f6368;
    }
    
    .calc-btn.operator {
        background: #1e3a5f;
        color: #8ab4f8;
    }
    
    .calc-btn.equals {
        background: #1a73e8;
    }
    
    .calc-btn.clear {
        background: #5f2120;
        color: #f28b82;
    }
    
    .calculator-close {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .calculator-close:hover {
        background: #5f6368;
    }
    
    /* Sports widget dark mode */
    .sports-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
    }
    
    .sports-header {
        color: #e8eaed;
    }
    
    .sport-tab {
        background: #3c4043;
        border-color: #5f6368;
        color: #9aa0a6;
    }
    
    .sport-tab:hover {
        background: #5f6368;
    }
    
    .sport-tab.active {
        background: #1a73e8;
        color: white;
    }
    
    .game-card {
        background: #3c4043;
    }
    
    .team-name,
    .game-score {
        color: #e8eaed;
    }
    
    .game-status {
        color: #9aa0a6;
    }
    
    .game-live {
        color: #f28b82;
    }
    
    .sports-loading {
        color: #9aa0a6;
    }
    
    .sports-close {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .sports-close:hover {
        background: #5f6368;
    }
    
    /* Mobile-specific weather detail colors */
    .weather-widget div[style*="color: #70757a"] {
        color: #9aa0a6 !important;
    }
    
    .weather-widget div[style*="color: #202124"] {
        color: #e8eaed !important;
    }
}

/* Tablet */
@media (min-width: 768px) {
    .shortcuts-grid {
        gap: 8px;
    }
    
    .shortcut-icon {
        width: 64px;
        height: 64px;
    }
    
    .shortcut img {
        width: 32px;
        height: 32px;
    }
}

/* Desktop */
@media (min-width: 1200px) {
    .shortcuts-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    
    .shortcut[data-priority="2"] {
        display: none;
    }
}
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo">Search AI</div>
        <div class="tagline">Fast. Clean. No spam.</div>
    </div>
    
    <div class="search-wrapper">
        <input id="searchSuggestion" class="search-suggestion" type="text" disabled />
        <input id="searchInput" class="search-box" type="text" placeholder="Search anything..." autocomplete="off" autofocus />
    </div>
    
    <!-- Widget Triggers -->
    <div class="widget-triggers">
        <div class="widget-icon" id="weatherTrigger" data-tooltip="Weather">
            <span class="icon-emoji">‚õÖ</span>
        </div>
        <div class="widget-icon" id="calculatorTrigger" data-tooltip="Calculator">
            <span class="icon-emoji">üî¢</span>
        </div>
        <div class="widget-icon" id="sportsTrigger" data-tooltip="Sports Scores">
            <span class="icon-emoji">üèÄ</span>
        </div>
    </div>
    
    <!-- Weather Widget -->
    <div id="weatherWidget" style="display: none;"></div>
    
    <!-- Calculator Widget -->
    <div id="calculatorWidget" style="display: none;"></div>
    
    <!-- Sports Widget -->
    <div id="sportsWidget" style="display: none;"></div>
    
    <div class="shortcuts-section" id="shortcutsSection">
        <div class="shortcuts-grid" id="shortcutsGrid"></div>
    </div>
    
    <div id="results" class="results-container"></div>
</div>

<script>
const input = document.getElementById("searchInput");
const suggestionInput = document.getElementById("searchSuggestion");
const resultsDiv = document.getElementById("results");
const shortcutsSection = document.getElementById("shortcutsSection");
const shortcutsGrid = document.getElementById("shortcutsGrid");
const weatherWidget = document.getElementById("weatherWidget");
const weatherTrigger = document.getElementById("weatherTrigger");
const calculatorWidget = document.getElementById("calculatorWidget");
const calculatorTrigger = document.getElementById("calculatorTrigger");
const sportsWidget = document.getElementById("sportsWidget");
const sportsTrigger = document.getElementById("sportsTrigger");

let shortcuts = [];
let navigationRouter = {};
let currentSuggestion = '';

// Weather API configuration
const WEATHER_API_KEY = '398b15f1e90c45738c260159260101';
let savedLocation = localStorage.getItem('weatherLocation') || 'auto:ip';
let weatherExpanded = false;
let selectedDay = 0;
let weatherLoaded = false;

// Calculator state
let calculatorLoaded = false;
let calcDisplay = '';

// Sports state
let sportsLoaded = false;
let currentSport = 'nfl';

fetch('/shortcuts.json')
    .then(res => res.json())
    .then(data => {
        shortcuts = data;
        renderShortcuts();
    });

fetch('/navigation-router.json')
    .then(res => res.json())
    .then(data => {
        navigationRouter = data;
    });

// Weather icon click handler
weatherTrigger.addEventListener('click', async function() {
    calculatorWidget.style.display = 'none';
    sportsWidget.style.display = 'none';
    
    if (!weatherLoaded) {
        const weatherData = await fetchWeather();
        if (weatherData) {
            window.currentWeatherData = weatherData;
            showWeatherWidget(weatherData);
            weatherLoaded = true;
        }
    } else {
        weatherWidget.style.display = 'block';
    }
});

// Calculator icon click handler
calculatorTrigger.addEventListener('click', function() {
    weatherWidget.style.display = 'none';
    sportsWidget.style.display = 'none';
    
    if (!calculatorLoaded) {
        showCalculator();
        calculatorLoaded = true;
    } else {
        calculatorWidget.style.display = 'block';
    }
});

// Sports icon click handler
sportsTrigger.addEventListener('click', async function() {
    weatherWidget.style.display = 'none';
    calculatorWidget.style.display = 'none';
    
    if (!sportsLoaded) {
        await showSports();
        sportsLoaded = true;
    } else {
        sportsWidget.style.display = 'block';
    }
});

// Sports Functions
async function fetchSportsScores(sport) {
    const endpoints = {
        'nfl': 'https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard',
        'nba': 'https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard',
        'mlb': 'https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard',
        'nhl': 'https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard',
        'soccer': 'https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/scoreboard'
    };
    
    try {
        const response = await fetch(endpoints[sport]);
        const data = await response.json();
        return data.events || [];
    } catch (error) {
        console.error('Sports fetch error:', error);
        return [];
    }
}

async function showSports() {
    sportsWidget.innerHTML = `
        <div class="sports-widget">
            <div class="sports-header">
                <span>üèÄ</span>
                <span>Live Sports Scores</span>
            </div>
            <div class="sports-tabs">
                <button class="sport-tab active" onclick="switchSport('nfl')">üèà NFL</button>
                <button class="sport-tab" onclick="switchSport('nba')">üèÄ NBA</button>
                <button class="sport-tab" onclick="switchSport('mlb')">‚öæ MLB</button>
                <button class="sport-tab" onclick="switchSport('nhl')">üèí NHL</button>
                <button class="sport-tab" onclick="switchSport('soccer')">‚öΩ Soccer</button>
            </div>
            <div class="sports-games" id="sportsGames">
                <div class="sports-loading">Loading scores...</div>
            </div>
            <button class="sports-close" onclick="closeSports()">Close</button>
        </div>
    `;
    
    sportsWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
    
    await loadSportGames('nfl');
}

async function switchSport(sport) {
    currentSport = sport;
    
    // Update active tab
    document.querySelectorAll('.sport-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    
    await loadSportGames(sport);
}

async function loadSportGames(sport) {
    const gamesContainer = document.getElementById('sportsGames');
    gamesContainer.innerHTML = '<div class="sports-loading">Loading scores...</div>';
    
    const games = await fetchSportsScores(sport);
    
    if (games.length === 0) {
        gamesContainer.innerHTML = '<div class="sports-loading">No games today</div>';
        return;
    }
    
    gamesContainer.innerHTML = games.map(game => {
        const competition = game.competitions[0];
        const homeTeam = competition.competitors.find(t => t.homeAway === 'home');
        const awayTeam = competition.competitors.find(t => t.homeAway === 'away');
        const status = competition.status;
        
        const isLive = status.type.state === 'in';
        const statusText = isLive ? `${status.type.shortDetail}` : status.type.shortDetail;
        
        return `
            <div class="game-card">
                <div style="flex: 1;">
                    <div class="game-team">
                        <div class="team-name">${awayTeam.team.shortDisplayName}</div>
                        <div class="game-score">${awayTeam.score || '0'}</div>
                    </div>
                    <div class="game-team" style="margin-top: 8px;">
                        <div class="team-name">${homeTeam.team.shortDisplayName}</div>
                        <div class="game-score">${homeTeam.score || '0'}</div>
                    </div>
                </div>
                <div style="text-align: right; min-width: 80px;">
                    <div class="game-status ${isLive ? 'game-live' : ''}">${statusText}</div>
                </div>
            </div>
        `;
    }).join('');
}

function closeSports() {
    sportsWidget.style.display = 'none';
    shortcutsSection.style.display = 'block';
}

// Calculator Functions
function showCalculator() {
    calculatorWidget.innerHTML = `
        <div class="calculator-widget">
            <div class="calculator-display" id="calcDisplay">0</div>
            <input type="text" id="calcInput" class="calculator-input" placeholder="Type expression (e.g., 2+2, sqrt(16))" />
            <div class="calculator-buttons">
                <button class="calc-btn" onclick="calcAppend('7')">7</button>
                <button class="calc-btn" onclick="calcAppend('8')">8</button>
                <button class="calc-btn" onclick="calcAppend('9')">9</button>
                <button class="calc-btn operator" onclick="calcAppend('/')">/</button>
                <button class="calc-btn" onclick="calcAppend('4')">4</button>
                <button class="calc-btn" onclick="calcAppend('5')">5</button>
                <button class="calc-btn" onclick="calcAppend('6')">6</button>
                <button class="calc-btn operator" onclick="calcAppend('*')">√ó</button>
                <button class="calc-btn" onclick="calcAppend('1')">1</button>
                <button class="calc-btn" onclick="calcAppend('2')">2</button>
                <button class="calc-btn" onclick="calcAppend('3')">3</button>
                <button class="calc-btn operator" onclick="calcAppend('-')">-</button>
                <button class="calc-btn" onclick="calcAppend('0')">0</button>
                <button class="calc-btn" onclick="calcAppend('.')">.</button>
                <button class="calc-btn equals" onclick="calcEquals()">=</button>
                <button class="calc-btn operator" onclick="calcAppend('+')">+</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 12px;">
                <button class="calc-btn clear" onclick="calcClear()">C</button>
                <button class="calc-btn" onclick="calcAppend('(')">(</button>
                <button class="calc-btn" onclick="calcAppend(')')">)</button>
                <button class="calc-btn operator" onclick="calcAppend('^')">^</button>
            </div>
            <button class="calculator-close" onclick="closeCalculator()">Close Calculator</button>
        </div>
    `;
    
    calculatorWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
    
    const calcInput = document.getElementById('calcInput');
    calcInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            calcEquals();
        }
    });
    
    calcInput.addEventListener('input', function() {
        calcDisplay = this.value;
        updateCalcDisplay();
    });
}

function calcAppend(value) {
    const calcInput = document.getElementById('calcInput');
    calcInput.value += value;
    calcDisplay = calcInput.value;
    updateCalcDisplay();
}

function calcClear() {
    const calcInput = document.getElementById('calcInput');
    calcInput.value = '';
    calcDisplay = '0';
    updateCalcDisplay();
}

function updateCalcDisplay() {
    const display = document.getElementById('calcDisplay');
    display.textContent = calcDisplay || '0';
}

function calcEquals() {
    const calcInput = document.getElementById('calcInput');
    let expression = calcInput.value;
    
    try {
        // Support common math functions
        expression = expression.replace(/sqrt\(([^)]+)\)/g, 'Math.sqrt($1)');
        expression = expression.replace(/sin\(([^)]+)\)/g, 'Math.sin($1*Math.PI/180)');
        expression = expression.replace(/cos\(([^)]+)\)/g, 'Math.cos($1*Math.PI/180)');
        expression = expression.replace(/tan\(([^)]+)\)/g, 'Math.tan($1*Math.PI/180)');
        expression = expression.replace(/log\(([^)]+)\)/g, 'Math.log10($1)');
        expression = expression.replace(/ln\(([^)]+)\)/g, 'Math.log($1)');
        expression = expression.replace(/\^/g, '**');
        
        const result = eval(expression);
        calcDisplay = result.toString();
        calcInput.value = calcDisplay;
        updateCalcDisplay();
    } catch (error) {
        calcDisplay = 'Error';
        updateCalcDisplay();
    }
}

function closeCalculator() {
    calculatorWidget.style.display = 'none';
    shortcutsSection.style.display = 'block';
}

function renderShortcuts() {
    shortcutsGrid.innerHTML = '';
    
    shortcuts.forEach(shortcut => {
        const link = document.createElement('a');
        link.className = 'shortcut';
        link.href = shortcut.url;
        link.dataset.priority = shortcut.priority;
        
        const iconWrapper = document.createElement('div');
        iconWrapper.className = 'shortcut-icon';
        
        const icon = document.createElement('img');
        icon.src = `https://www.google.com/s2/favicons?domain=${shortcut.domain}&sz=32`;
        icon.alt = shortcut.name;
        
        const name = document.createElement('span');
        name.textContent = shortcut.name;
        
        iconWrapper.appendChild(icon);
        link.appendChild(iconWrapper);
        link.appendChild(name);
        shortcutsGrid.appendChild(link);
    });
}

// Weather Functions
async function fetchWeather(location = savedLocation) {
    try {
        const response = await fetch(
            `https://api.weatherapi.com/v1/forecast.json?key=${WEATHER_API_KEY}&q=${location}&days=3&aqi=yes`
        );
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Weather fetch error:', error);
        return null;
    }
}

function showWeatherWidget(data) {
    if (!data) return;
    
    const current = data.current;
    const location = data.location;
    const forecast = data.forecast.forecastday;
    const hourly = forecast[selectedDay].hour;
    
    const rainDistance = current.precip_mm > 0 ? 'It\'s raining now' : 'No rain nearby';
    
    weatherWidget.innerHTML = `
        <div class="weather-widget">
            <div class="weather-widget-small">
                <div style="flex: 1;">
                    <div class="weather-location">
                        <span>${location.name}, ${location.region}</span>
                        <span style="cursor: pointer;" onclick="event.stopPropagation(); toggleLocationInput()">üè†</span>
                    </div>
                    <div class="weather-time">As of ${new Date(current.last_updated).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}</div>
                    
                    <div style="display: flex; gap: 20px; align-items: flex-start;">
                        <div class="weather-main">
                            <img src="https:${current.condition.icon}" alt="${current.condition.text}" class="weather-icon" />
                            <div>
                                <span class="weather-temp">${Math.round(current.temp_f)}</span>
                                <span class="weather-unit">¬∞F</span>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; margin-top: 8px;">
                            <div>
                                <div style="color: #70757a;">Visibility</div>
                                <div style="font-weight: 600; color: #202124;">${current.vis_miles} mi</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">Pressure</div>
                                <div style="font-weight: 600; color: #202124;">${current.pressure_in} in</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">Humidity</div>
                                <div style="font-weight: 600; color: #202124;">${current.humidity}%</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">UV Index</div>
                                <div style="font-weight: 600; color: #202124;">${current.uv}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="weather-rain-info">
                        <span>‚ÑπÔ∏è</span>
                        <span>${rainDistance}</span>
                    </div>
                    
                    <div class="weather-change-location" style="display: none; margin-top: 12px;" id="locationChanger">
                        <input type="text" class="weather-location-input" placeholder="Enter city name..." id="locationInput" onkeypress="if(event.key==='Enter') updateLocation()" />
                    </div>
                </div>
            </div>
            
            <button class="weather-expand-btn" onclick="toggleWeatherExpand()">
                <span id="expandBtnText">${weatherExpanded ? 'Show less' : 'See full forecast'}</span>
            </button>
            
            <div class="weather-widget-full ${weatherExpanded ? 'expanded' : ''}" id="weatherFull">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; font-weight: 600; color: #202124; margin-bottom: 12px;">
                        Hourly Forecast - ${forecast[selectedDay].date === forecast[0].date ? 'Today' : new Date(forecast[selectedDay].date).toLocaleDateString('en-US', { weekday: 'long' })}
                    </div>
                    <div class="hourly-forecast-container">
                        ${hourly.filter((_, i) => i % 3 === 0).map(hour => {
                            const time = new Date(hour.time).toLocaleTimeString('en-US', { hour: 'numeric' });
                            return `
                                <div class="hourly-item">
                                    <div style="font-size: 12px; color: #70757a; margin-bottom: 8px;">${time}</div>
                                    <img src="https:${hour.condition.icon}" alt="${hour.condition.text}" style="width: 40px; height: 40px; margin: 0 auto;" />
                                    <div style="font-size: 16px; font-weight: 600; color: #202124; margin-top: 8px;">${Math.round(hour.temp_f)}¬∞</div>
                                    <div style="font-size: 11px; color: #70757a; margin-top: 4px;">${hour.chance_of_rain}%</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 16px;">
                    <div style="font-size: 14px; font-weight: 600; color: #202124; margin-bottom: 12px;">3-Day Forecast</div>
                    <div class="weather-forecast">
                        ${forecast.map((day, index) => `
                            <div class="forecast-day" onclick="event.stopPropagation(); selectDay(${index})" style="cursor: pointer; opacity: ${selectedDay === index ? '1' : '0.7'}; transform: ${selectedDay === index ? 'scale(1.05)' : 'scale(1)'}; transition: all 0.2s;">
                                <div class="forecast-day-name">${index === 0 ? 'Today' : new Date(day.date).toLocaleDateString('en-US', { weekday: 'short' })}</div>
                                <img src="https:${day.day.condition.icon}" alt="${day.day.condition.text}" class="forecast-icon" />
                                <div class="forecast-temp">
                                    <span class="forecast-temp-high">${Math.round(day.day.maxtemp_f)}¬∞</span>
                                    <span class="forecast-temp-low">${Math.round(day.day.mintemp_f)}¬∞</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        </div>
    `;
    
    weatherWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
}

function toggleWeatherExpand() {
    weatherExpanded = !weatherExpanded;
    const weatherData = window.currentWeatherData;
    if (weatherData) {
        showWeatherWidget(weatherData);
    }
}

function toggleLocationInput() {
    const changer = document.getElementById('locationChanger');
    changer.style.display = changer.style.display === 'none' ? 'block' : 'none';
    if (changer.style.display === 'block') {
        document.getElementById('locationInput').focus();
    }
}

function selectDay(dayIndex) {
    selectedDay = dayIndex;
    const weatherData = window.currentWeatherData;
    if (weatherData) {
        showWeatherWidget(weatherData);
    }
}

async function updateLocation() {
    const newLocation = document.getElementById('locationInput').value.trim();
    if (newLocation) {
        savedLocation = newLocation;
        localStorage.setItem('weatherLocation', newLocation);
        const data = await fetchWeather(newLocation);
        if (data) {
            window.currentWeatherData = data;
            showWeatherWidget(data);
            toggleLocationInput();
        }
    }
}

// Autocomplete
function findSuggestion(query) {
    if (!query || query.length < 2) return '';
    
    const cleaned = query.toLowerCase().trim();
    
    for (let key in navigationRouter) {
        if (key.startsWith(cleaned) && key !== cleaned) {
            return key;
        }
    }
    
    return '';
}

function updateSuggestion() {
    const query = input.value;
    const suggestion = findSuggestion(query);
    
    if (suggestion && query.length >= 2) {
        currentSuggestion = suggestion;
        suggestionInput.value = query + suggestion.slice(query.length);
    } else {
        currentSuggestion = '';
        suggestionInput.value = '';
    }
}

function completeSuggestion() {
    if (currentSuggestion) {
        input.value = currentSuggestion;
        suggestionInput.value = '';
        currentSuggestion = '';
        input.focus();
    }
}

function checkNavigation(query) {
    const cleaned = query.toLowerCase().trim();
    return navigationRouter[cleaned];
}

input.addEventListener("input", function() {
    updateSuggestion();
    
    if (this.value.trim() === '') {
        resultsDiv.innerHTML = '';
        weatherWidget.style.display = 'block';
        shortcutsSection.style.display = 'none';
    }
});

input.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
        e.preventDefault();
        handleSearch();
    } else if (e.key === "ArrowRight") {
        if (currentSuggestion && input.selectionStart === input.value.length) {
            e.preventDefault();
            completeSuggestion();
        }
    }
});

input.addEventListener("click", function() {
    if (currentSuggestion) {
        completeSuggestion();
    }
});

function handleSearch() {
    const q = input.value.trim();
    if (!q) return;
    
    suggestionInput.value = '';
    currentSuggestion = '';
    
    // Check if weather query
    if (q.toLowerCase() === 'weather' || q.toLowerCase().startsWith('weather in ')) {
        const location = q.toLowerCase().startsWith('weather in ') ? q.slice(11).trim() : savedLocation;
        fetchWeather(location).then(data => {
            if (data) {
                savedLocation = location;
                localStorage.setItem('weatherLocation', location);
                window.currentWeatherData = data;
                showWeatherWidget(data);
                resultsDiv.innerHTML = '';
            }
        });
        return;
    }
    
    const navUrl = checkNavigation(q);
    if (navUrl) {
        window.location.href = navUrl;
        return;
    }
    
    search(q);
}

function search(query) {
    weatherWidget.style.display = 'none';
    shortcutsSection.style.display = 'none';
    resultsDiv.innerHTML = '<div class="loading">Searching...</div>';

    fetch(`/api/search?q=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(data => {
            resultsDiv.innerHTML = "";
            
            if (data.length === 0) {
                resultsDiv.innerHTML = '<div class="loading">No results found</div>';
                return;
            }

            data.forEach(item => {
                const div = document.createElement("div");
                div.className = "result";

                const summaryId = "summary-" + Math.random().toString(36).substr(2, 9);

                div.innerHTML = `
                    <div class="result-url">
                        ${item.favicon ? `<img src="${item.favicon}" alt="">` : ""}
                        <div class="result-url-text">${escapeHtml(item.source)}</div>
                    </div>
                    <h3 class="result-title">
                        <a href="${escapeHtml(item.url)}" target="_blank">${escapeHtml(item.title)}</a>
                    </h3>
                    <div id="${summaryId}" class="result-snippet">${escapeHtml(item.summary)}</div>
                    <a class="read-more" onclick="toggleSummary('${summaryId}', this)">More</a>
                `;

                resultsDiv.appendChild(div);
            });
        })
        .catch(err => {
            resultsDiv.innerHTML = `<div class="error">Search failed. Please try again.</div>`;
        });
}

function toggleSummary(id, el) {
    const s = document.getElementById(id);
    s.classList.toggle("expanded");
    el.textContent = s.classList.contains("expanded") ? "Less" : "More";
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>

</body>
</html>