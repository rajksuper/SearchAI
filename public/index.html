<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search AI - Fast. Clean. No spam.</title>
<style>
body {
    font-family: arial, sans-serif;
    background: #fff;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 652px;
    margin: 20px auto;
    padding: 0 16px;
}

.header {
    text-align: center;
    margin-bottom: 30px;
}

.logo {
    font-size: 48px;
    font-weight: 400;
    color: #202124;
    margin-bottom: 4px;
    letter-spacing: -1px;
}

.tagline {
    font-size: 13px;
    color: #70757a;
    margin-bottom: 28px;
}

.search-box {
    width: 100%;
    max-width: 584px;
    padding: 13px 16px;
    font-size: 16px;
    border: 1px solid #dfe1e5;
    border-radius: 24px;
    outline: none;
    box-sizing: border-box;
    position: relative;
    background: transparent;
    z-index: 2;
    margin: 0 auto;
    display: block;
}

.search-box:hover {
    border-color: #ccc;
    box-shadow: 0 1px 6px rgba(32,33,36,.28);
}

.search-box:focus {
    border-color: transparent;
    box-shadow: 0 1px 6px rgba(32,33,36,.28);
}

.search-wrapper {
    position: relative;
    max-width: 584px;
    margin: 0 auto 20px;
}

.search-suggestion {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 13px 16px;
    font-size: 16px;
    border: 1px solid transparent;
    border-radius: 24px;
    color: #80868b;
    pointer-events: none;
    box-sizing: border-box;
    z-index: 1;
}

/* Shortcuts */
.shortcuts-section {
    margin: 30px 0;
}

.shortcuts-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
}

.shortcut {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px;
    text-decoration: none;
    color: #202124;
    cursor: pointer;
}

.shortcut:hover {
    opacity: 0.8;
}

.shortcut-icon {
    width: 56px;
    height: 56px;
    background: #f1f3f4;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
}

.shortcut img {
    width: 32px;
    height: 32px;
}

.shortcut span {
    font-size: 13px;
    text-align: center;
}

.shortcut[data-priority="2"] {
    display: none;
}

/* Weather Widget */
.weather-widget {
    background: white;
    border-radius: 12px;
    padding: 16px 20px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    max-width: 400px;
    margin: 20px auto;
    transition: all 0.2s;
}

.weather-widget:hover {
    box-shadow: 0 2px 12px rgba(0,0,0,0.15);
}

.weather-widget-small {
    display: flex;
    align-items: center;
    gap: 16px;
}

.weather-location {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 16px;
    font-weight: 600;
    color: #202124;
    margin-bottom: 4px;
}

.weather-time {
    font-size: 12px;
    color: #70757a;
    margin-bottom: 8px;
}

.weather-main {
    display: flex;
    align-items: center;
    gap: 12px;
}

.weather-icon {
    width: 64px;
    height: 64px;
}

.weather-temp {
    font-size: 48px;
    font-weight: 300;
    color: #202124;
}

.weather-unit {
    font-size: 24px;
    color: #70757a;
}

.weather-condition {
    font-size: 18px;
    color: #202124;
    margin-left: auto;
}

.weather-rain-info {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: #1a73e8;
    margin-top: 8px;
}

.weather-expand-btn {
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    color: #202124;
    cursor: pointer;
    margin-top: 12px;
    width: 100%;
}

.weather-expand-btn:hover {
    background: #f1f3f4;
}

.weather-widget-full {
    display: none;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #dadce0;
}

.weather-widget-full.expanded {
    display: block;
}

.weather-forecast {
    display: flex;
    gap: 12px;
    padding: 12px 0;
}

.forecast-day {
    text-align: center;
    min-width: 80px;
}

.forecast-day-name {
    font-size: 12px;
    color: #70757a;
    margin-bottom: 8px;
}

.forecast-icon {
    width: 40px;
    height: 40px;
    margin: 0 auto;
}

.forecast-temp {
    font-size: 14px;
    color: #202124;
    margin-top: 8px;
}

.forecast-temp-high {
    font-weight: 600;
}

.forecast-temp-low {
    color: #70757a;
}

.weather-change-location {
    margin-top: 16px;
}

.weather-location-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #dadce0;
    border-radius: 20px;
    font-size: 14px;
    outline: none;
}

.weather-location-input:focus {
    border-color: #1a73e8;
}

/* Results */
.results-container {
    margin-top: 20px;
}

.result {
    margin-bottom: 28px;
}

.result-url {
    display: flex;
    align-items: center;
    margin-bottom: 3px;
}

.result-url img {
    width: 18px;
    height: 18px;
    margin-right: 12px;
}

.result-url-text {
    font-size: 14px;
    line-height: 20px;
    color: #202124;
}

.result-title {
    margin: 0 0 3px 0;
    font-size: 20px;
    line-height: 26px;
}

.result-title a {
    color: #1a0dab;
    text-decoration: none;
}

.result-title a:visited {
    color: #681da8;
}

.result-title a:hover {
    text-decoration: underline;
}

.result-snippet {
    font-size: 14px;
    line-height: 22px;
    color: #4d5156;
    max-height: 44px;
    overflow: hidden;
}

.result-snippet.expanded {
    max-height: none;
}

.read-more {
    font-size: 14px;
    color: #1a0dab;
    cursor: pointer;
    margin-top: 4px;
    display: inline-block;
}

.read-more:hover {
    text-decoration: underline;
}

.loading {
    color: #70757a;
    padding: 20px 0;
}

.error {
    color: #d93025;
    padding: 20px 0;
}

/* Mobile Dark Mode */
@media (max-width: 768px) {
    body {
        background: #1a1a1a;
        color: #e8eaed;
    }
    
    .logo {
        color: #e8eaed;
    }
    
    .tagline {
        color: #9aa0a6;
    }
    
    .search-box {
        background: #2d2d2d;
        border: 1px solid #3c4043;
        color: #e8eaed;
    }
    
    .search-box::placeholder {
        color: #9aa0a6;
    }
    
    .search-suggestion {
        color: #5f6368;
    }
    
    .result {
        background: #2d2d2d;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 12px;
    }
    
    .result-url-text {
        color: #9aa0a6;
    }
    
    .result-title a {
        color: #8ab4f8;
    }
    
    .result-title a:visited {
        color: #c58af9;
    }
    
    .result-snippet {
        color: #bdc1c6;
    }
    
    .read-more {
        color: #8ab4f8;
    }
    
    .loading {
        color: #9aa0a6;
    }
    
    .error {
        color: #f28b82;
    }
    
    /* Weather widget dark mode */
    .weather-widget {
        background: #2d2d2d;
        box-shadow: 0 1px 6px rgba(0,0,0,0.3);
    }
    
    .weather-location,
    .weather-temp {
        color: #e8eaed;
    }
    
    .weather-time,
    .weather-unit,
    .forecast-day-name,
    .forecast-temp-low {
        color: #9aa0a6;
    }
    
    .weather-expand-btn {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .weather-widget-full {
        border-top-color: #5f6368;
    }
    
    .weather-location-input {
        background: #3c4043;
        border-color: #5f6368;
        color: #e8eaed;
    }
    
    .shortcut {
        color: #e8eaed;
    }
    
    .shortcut-icon {
        background: #3c4043;
    }
}

/* Tablet */
@media (min-width: 768px) {
    .shortcuts-grid {
        gap: 8px;
    }
    
    .shortcut-icon {
        width: 64px;
        height: 64px;
    }
    
    .shortcut img {
        width: 32px;
        height: 32px;
    }
}

/* Desktop */
@media (min-width: 1200px) {
    .shortcuts-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    
    .shortcut[data-priority="2"] {
        display: none;
    }
}
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo">Search AI</div>
        <div class="tagline">Fast. Clean. No spam.</div>
    </div>
    
    <div class="search-wrapper">
        <input id="searchSuggestion" class="search-suggestion" type="text" disabled />
        <input id="searchInput" class="search-box" type="text" placeholder="Search anything..." autocomplete="off" autofocus />
    </div>
    
    <!-- Weather Widget -->
    <div id="weatherWidget" style="display: none;"></div>
    
    <div class="shortcuts-section" id="shortcutsSection">
        <div class="shortcuts-grid" id="shortcutsGrid"></div>
    </div>
    
    <div id="results" class="results-container"></div>
</div>

<script>
const input = document.getElementById("searchInput");
const suggestionInput = document.getElementById("searchSuggestion");
const resultsDiv = document.getElementById("results");
const shortcutsSection = document.getElementById("shortcutsSection");
const shortcutsGrid = document.getElementById("shortcutsGrid");
const weatherWidget = document.getElementById("weatherWidget");

let shortcuts = [];
let navigationRouter = {};
let currentSuggestion = '';

// Weather API configuration
const WEATHER_API_KEY = '398b15f1e90c45738c260159260101';
let savedLocation = localStorage.getItem('weatherLocation') || 'auto:ip';
let weatherExpanded = false;
let selectedDay = 0;

fetch('/shortcuts.json')
    .then(res => res.json())
    .then(data => {
        shortcuts = data;
        renderShortcuts();
    });

fetch('/navigation-router.json')
    .then(res => res.json())
    .then(data => {
        navigationRouter = data;
    });

function renderShortcuts() {
    shortcutsGrid.innerHTML = '';
    
    shortcuts.forEach(shortcut => {
        const link = document.createElement('a');
        link.className = 'shortcut';
        link.href = shortcut.url;
        link.dataset.priority = shortcut.priority;
        
        const iconWrapper = document.createElement('div');
        iconWrapper.className = 'shortcut-icon';
        
        const icon = document.createElement('img');
        icon.src = `https://www.google.com/s2/favicons?domain=${shortcut.domain}&sz=32`;
        icon.alt = shortcut.name;
        
        const name = document.createElement('span');
        name.textContent = shortcut.name;
        
        iconWrapper.appendChild(icon);
        link.appendChild(iconWrapper);
        link.appendChild(name);
        shortcutsGrid.appendChild(link);
    });
}

// Weather Functions
async function fetchWeather(location = savedLocation) {
    try {
        const response = await fetch(
            `https://api.weatherapi.com/v1/forecast.json?key=${WEATHER_API_KEY}&q=${location}&days=3&aqi=yes`
        );
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Weather fetch error:', error);
        return null;
    }
}

function showWeatherWidget(data) {
    if (!data) return;
    
    const current = data.current;
    const location = data.location;
    const forecast = data.forecast.forecastday;
    const hourly = forecast[selectedDay].hour;
    
    const rainDistance = current.precip_mm > 0 ? 'It\'s raining now' : 'No rain nearby';
    
    weatherWidget.innerHTML = `
        <div class="weather-widget">
            <div class="weather-widget-small">
                <div style="flex: 1;">
                    <div class="weather-location">
                        <span>${location.name}, ${location.region}</span>
                        <span style="cursor: pointer;" onclick="event.stopPropagation(); toggleLocationInput()">üè†</span>
                    </div>
                    <div class="weather-time">As of ${new Date(current.last_updated).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}</div>
                    
                    <div style="display: flex; gap: 20px; align-items: flex-start;">
                        <div class="weather-main">
                            <img src="https:${current.condition.icon}" alt="${current.condition.text}" class="weather-icon" />
                            <div>
                                <span class="weather-temp">${Math.round(current.temp_f)}</span>
                                <span class="weather-unit">¬∞F</span>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; margin-top: 8px;">
                            <div>
                                <div style="color: #70757a;">Visibility</div>
                                <div style="font-weight: 600; color: #202124;">${current.vis_miles} mi</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">Pressure</div>
                                <div style="font-weight: 600; color: #202124;">${current.pressure_in} in</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">Humidity</div>
                                <div style="font-weight: 600; color: #202124;">${current.humidity}%</div>
                            </div>
                            <div>
                                <div style="color: #70757a;">UV Index</div>
                                <div style="font-weight: 600; color: #202124;">${current.uv}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="weather-rain-info">
                        <span>‚ÑπÔ∏è</span>
                        <span>${rainDistance}</span>
                    </div>
                    
                    <div class="weather-change-location" style="display: none; margin-top: 12px;" id="locationChanger">
                        <input type="text" class="weather-location-input" placeholder="Enter city name..." id="locationInput" onkeypress="if(event.key==='Enter') updateLocation()" />
                    </div>
                </div>
            </div>
            
            <button class="weather-expand-btn" onclick="toggleWeatherExpand()">
                <span id="expandBtnText">${weatherExpanded ? 'Show less' : 'See full forecast'}</span>
            </button>
            
            <div class="weather-widget-full ${weatherExpanded ? 'expanded' : ''}" id="weatherFull">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; font-weight: 600; color: #202124; margin-bottom: 12px;">
                        Hourly Forecast - ${forecast[selectedDay].date === forecast[0].date ? 'Today' : new Date(forecast[selectedDay].date).toLocaleDateString('en-US', { weekday: 'long' })}
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 12px; padding: 12px 0;">
                        ${hourly.filter((_, i) => i % 3 === 0).map(hour => {
                            const time = new Date(hour.time).toLocaleTimeString('en-US', { hour: 'numeric' });
                            return `
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #70757a; margin-bottom: 8px;">${time}</div>
                                    <img src="https:${hour.condition.icon}" alt="${hour.condition.text}" style="width: 40px; height: 40px; margin: 0 auto;" />
                                    <div style="font-size: 16px; font-weight: 600; color: #202124; margin-top: 8px;">${Math.round(hour.temp_f)}¬∞</div>
                                    <div style="font-size: 11px; color: #70757a; margin-top: 4px;">${hour.chance_of_rain}%</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 16px;">
                    <div style="font-size: 14px; font-weight: 600; color: #202124; margin-bottom: 12px;">3-Day Forecast</div>
                    <div class="weather-forecast">
                        ${forecast.map((day, index) => `
                            <div class="forecast-day" onclick="event.stopPropagation(); selectDay(${index})" style="cursor: pointer; opacity: ${selectedDay === index ? '1' : '0.7'}; transform: ${selectedDay === index ? 'scale(1.05)' : 'scale(1)'}; transition: all 0.2s;">
                                <div class="forecast-day-name">${index === 0 ? 'Today' : new Date(day.date).toLocaleDateString('en-US', { weekday: 'short' })}</div>
                                <img src="https:${day.day.condition.icon}" alt="${day.day.condition.text}" class="forecast-icon" />
                                <div class="forecast-temp">
                                    <span class="forecast-temp-high">${Math.round(day.day.maxtemp_f)}¬∞</span>
                                    <span class="forecast-temp-low">${Math.round(day.day.mintemp_f)}¬∞</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        </div>
    `;
    
    weatherWidget.style.display = 'block';
    shortcutsSection.style.display = 'none';
}

function toggleWeatherExpand() {
    weatherExpanded = !weatherExpanded;
    const weatherData = window.currentWeatherData;
    if (weatherData) {
        showWeatherWidget(weatherData);
    }
}

function toggleLocationInput() {
    const changer = document.getElementById('locationChanger');
    changer.style.display = changer.style.display === 'none' ? 'block' : 'none';
    if (changer.style.display === 'block') {
        document.getElementById('locationInput').focus();
    }
}

function selectDay(dayIndex) {
    selectedDay = dayIndex;
    const weatherData = window.currentWeatherData;
    if (weatherData) {
        showWeatherWidget(weatherData);
    }
}

async function updateLocation() {
    const newLocation = document.getElementById('locationInput').value.trim();
    if (newLocation) {
        savedLocation = newLocation;
        localStorage.setItem('weatherLocation', newLocation);
        const data = await fetchWeather(newLocation);
        if (data) {
            window.currentWeatherData = data;
            showWeatherWidget(data);
            toggleLocationInput();
        }
    }
}

// Load weather on page load
(async function() {
    const weatherData = await fetchWeather();
    if (weatherData) {
        window.currentWeatherData = weatherData;
        showWeatherWidget(weatherData);
    }
})();

// Autocomplete
function findSuggestion(query) {
    if (!query || query.length < 2) return '';
    
    const cleaned = query.toLowerCase().trim();
    
    for (let key in navigationRouter) {
        if (key.startsWith(cleaned) && key !== cleaned) {
            return key;
        }
    }
    
    return '';
}

function updateSuggestion() {
    const query = input.value;
    const suggestion = findSuggestion(query);
    
    if (suggestion && query.length >= 2) {
        currentSuggestion = suggestion;
        suggestionInput.value = query + suggestion.slice(query.length);
    } else {
        currentSuggestion = '';
        suggestionInput.value = '';
    }
}

function completeSuggestion() {
    if (currentSuggestion) {
        input.value = currentSuggestion;
        suggestionInput.value = '';
        currentSuggestion = '';
        input.focus();
    }
}

function checkNavigation(query) {
    const cleaned = query.toLowerCase().trim();
    return navigationRouter[cleaned];
}

input.addEventListener("input", function() {
    updateSuggestion();
    
    if (this.value.trim() === '') {
        resultsDiv.innerHTML = '';
        weatherWidget.style.display = 'block';
        shortcutsSection.style.display = 'none';
    }
});

input.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
        e.preventDefault();
        handleSearch();
    } else if (e.key === "ArrowRight") {
        if (currentSuggestion && input.selectionStart === input.value.length) {
            e.preventDefault();
            completeSuggestion();
        }
    }
});

input.addEventListener("click", function() {
    if (currentSuggestion) {
        completeSuggestion();
    }
});

function handleSearch() {
    const q = input.value.trim();
    if (!q) return;
    
    suggestionInput.value = '';
    currentSuggestion = '';
    
    // Check if weather query
    if (q.toLowerCase() === 'weather' || q.toLowerCase().startsWith('weather in ')) {
        const location = q.toLowerCase().startsWith('weather in ') ? q.slice(11).trim() : savedLocation;
        fetchWeather(location).then(data => {
            if (data) {
                savedLocation = location;
                localStorage.setItem('weatherLocation', location);
                window.currentWeatherData = data;
                showWeatherWidget(data);
                resultsDiv.innerHTML = '';
            }
        });
        return;
    }
    
    const navUrl = checkNavigation(q);
    if (navUrl) {
        window.location.href = navUrl;
        return;
    }
    
    search(q);
}

function search(query) {
    weatherWidget.style.display = 'none';
    shortcutsSection.style.display = 'none';
    resultsDiv.innerHTML = '<div class="loading">Searching...</div>';

    fetch(`/api/search?q=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(data => {
            resultsDiv.innerHTML = "";
            
            if (data.length === 0) {
                resultsDiv.innerHTML = '<div class="loading">No results found</div>';
                return;
            }

            data.forEach(item => {
                const div = document.createElement("div");
                div.className = "result";

                const summaryId = "summary-" + Math.random().toString(36).substr(2, 9);

                div.innerHTML = `
                    <div class="result-url">
                        ${item.favicon ? `<img src="${item.favicon}" alt="">` : ""}
                        <div class="result-url-text">${escapeHtml(item.source)}</div>
                    </div>
                    <h3 class="result-title">
                        <a href="${escapeHtml(item.url)}" target="_blank">${escapeHtml(item.title)}</a>
                    </h3>
                    <div id="${summaryId}" class="result-snippet">${escapeHtml(item.summary)}</div>
                    <a class="read-more" onclick="toggleSummary('${summaryId}', this)">More</a>
                `;

                resultsDiv.appendChild(div);
            });
        })
        .catch(err => {
            resultsDiv.innerHTML = `<div class="error">Search failed. Please try again.</div>`;
        });
}

function toggleSummary(id, el) {
    const s = document.getElementById(id);
    s.classList.toggle("expanded");
    el.textContent = s.classList.contains("expanded") ? "Less" : "More";
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>

</body>
</html>